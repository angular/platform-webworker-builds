{"version":3,"file":"renderer.js","sourceRoot":"","sources":["../../../../../../../packages/platform-webworker/src/web_workers/ui/renderer.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nimport {Injectable, Renderer2, RendererFactory2, RendererStyleFlags2, RendererType2} from '@angular/core';\n\nimport {MessageBus} from '../shared/message_bus';\nimport {EVENT_2_CHANNEL, RENDERER_2_CHANNEL} from '../shared/messaging_api';\nimport {RenderStore} from '../shared/render_store';\nimport {Serializer, SerializerTypes} from '../shared/serializer';\nimport {ServiceMessageBroker, ServiceMessageBrokerFactory} from '../shared/service_message_broker';\nimport {EventDispatcher} from '../ui/event_dispatcher';\n\n@Injectable()\nexport class MessageBasedRenderer2 {\n  private _eventDispatcher: EventDispatcher;\n\n  constructor(\n      private _brokerFactory: ServiceMessageBrokerFactory, private _bus: MessageBus,\n      private _serializer: Serializer, private _renderStore: RenderStore,\n      private _rendererFactory: RendererFactory2) {}\n\n  start(): void {\n    const broker = this._brokerFactory.createMessageBroker(RENDERER_2_CHANNEL);\n\n    this._bus.initChannel(EVENT_2_CHANNEL);\n    this._eventDispatcher = new EventDispatcher(this._bus.to(EVENT_2_CHANNEL), this._serializer);\n\n    const [RSO, P, CRT] = [\n      SerializerTypes.RENDER_STORE_OBJECT,\n      SerializerTypes.PRIMITIVE,\n      SerializerTypes.RENDERER_TYPE_2,\n    ];\n\n    const methods: any[][] = [\n      ['createRenderer', this.createRenderer, RSO, CRT, P],\n      ['createElement', this.createElement, RSO, P, P, P],\n      ['createComment', this.createComment, RSO, P, P], ['createText', this.createText, RSO, P, P],\n      ['appendChild', this.appendChild, RSO, RSO, RSO],\n      ['insertBefore', this.insertBefore, RSO, RSO, RSO, RSO],\n      ['removeChild', this.removeChild, RSO, RSO, RSO],\n      ['selectRootElement', this.selectRootElement, RSO, P, P],\n      ['parentNode', this.parentNode, RSO, RSO, P], ['nextSibling', this.nextSibling, RSO, RSO, P],\n      ['setAttribute', this.setAttribute, RSO, RSO, P, P, P],\n      ['removeAttribute', this.removeAttribute, RSO, RSO, P, P],\n      ['addClass', this.addClass, RSO, RSO, P], ['removeClass', this.removeClass, RSO, RSO, P],\n      ['setStyle', this.setStyle, RSO, RSO, P, P, P],\n      ['removeStyle', this.removeStyle, RSO, RSO, P, P],\n      ['setProperty', this.setProperty, RSO, RSO, P, P], ['setValue', this.setValue, RSO, RSO, P],\n      ['listen', this.listen, RSO, RSO, P, P, P], ['unlisten', this.unlisten, RSO, RSO],\n      ['destroy', this.destroy, RSO], ['destroyNode', this.destroyNode, RSO, P]\n\n    ];\n\n    methods.forEach(([name, method, ...argTypes]: any[]) => {\n      broker.registerMethod(name, argTypes, method.bind(this));\n    });\n  }\n\n  private destroy(r: Renderer2) { r.destroy(); }\n\n  private destroyNode(r: Renderer2, node: any) {\n    if (r.destroyNode) {\n      r.destroyNode(node);\n    }\n    this._renderStore.remove(node);\n  }\n\n  private createRenderer(el: any, type: RendererType2, id: number) {\n    this._renderStore.store(this._rendererFactory.createRenderer(el, type), id);\n  }\n\n  private createElement(r: Renderer2, name: string, namespace: string, id: number) {\n    this._renderStore.store(r.createElement(name, namespace), id);\n  }\n\n  private createComment(r: Renderer2, value: string, id: number) {\n    this._renderStore.store(r.createComment(value), id);\n  }\n\n  private createText(r: Renderer2, value: string, id: number) {\n    this._renderStore.store(r.createText(value), id);\n  }\n\n  private appendChild(r: Renderer2, parent: any, child: any) { r.appendChild(parent, child); }\n\n  private insertBefore(r: Renderer2, parent: any, child: any, ref: any) {\n    r.insertBefore(parent, child, ref);\n  }\n\n  private removeChild(r: Renderer2, parent: any, child: any) { r.removeChild(parent, child); }\n\n  private selectRootElement(r: Renderer2, selector: string, id: number) {\n    this._renderStore.store(r.selectRootElement(selector), id);\n  }\n\n  private parentNode(r: Renderer2, node: any, id: number) {\n    this._renderStore.store(r.parentNode(node), id);\n  }\n\n  private nextSibling(r: Renderer2, node: any, id: number) {\n    this._renderStore.store(r.nextSibling(node), id);\n  }\n\n  private setAttribute(r: Renderer2, el: any, name: string, value: string, namespace: string) {\n    r.setAttribute(el, name, value, namespace);\n  }\n\n  private removeAttribute(r: Renderer2, el: any, name: string, namespace: string) {\n    r.removeAttribute(el, name, namespace);\n  }\n\n  private addClass(r: Renderer2, el: any, name: string) { r.addClass(el, name); }\n\n  private removeClass(r: Renderer2, el: any, name: string) { r.removeClass(el, name); }\n\n  private setStyle(r: Renderer2, el: any, style: string, value: any, flags: RendererStyleFlags2) {\n    r.setStyle(el, style, value, flags);\n  }\n\n  private removeStyle(r: Renderer2, el: any, style: string, flags: RendererStyleFlags2) {\n    r.removeStyle(el, style, flags);\n  }\n\n  private setProperty(r: Renderer2, el: any, name: string, value: any) {\n    r.setProperty(el, name, value);\n  }\n\n  private setValue(r: Renderer2, node: any, value: string) { r.setValue(node, value); }\n\n  private listen(r: Renderer2, el: any, elName: string, eventName: string, unlistenId: number) {\n    const listener = (event: any) => {\n      return this._eventDispatcher.dispatchRenderEvent(el, elName, eventName, event);\n    };\n\n    const unlisten = r.listen(el || elName, eventName, listener);\n    this._renderStore.store(unlisten, unlistenId);\n  }\n\n  private unlisten(r: Renderer2, unlisten: () => boolean) { unlisten(); }\n}\n"]}