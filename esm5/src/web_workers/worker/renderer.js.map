{"version":3,"file":"renderer.js","sourceRoot":"","sources":["../../../../../../../packages/platform-webworker/src/web_workers/worker/renderer.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nimport {Injectable, Renderer2, RendererFactory2, RendererStyleFlags2, RendererType2} from '@angular/core';\n\nimport {ClientMessageBroker, ClientMessageBrokerFactory, FnArg, UiArguments} from '../shared/client_message_broker';\nimport {MessageBus} from '../shared/message_bus';\nimport {EVENT_2_CHANNEL, RENDERER_2_CHANNEL} from '../shared/messaging_api';\nimport {RenderStore} from '../shared/render_store';\nimport {Serializer, SerializerTypes} from '../shared/serializer';\n\nexport class NamedEventEmitter {\n  private _listeners: Map<string, Function[]>;\n\n  listen(eventName: string, callback: Function) { this._getListeners(eventName).push(callback); }\n\n  unlisten(eventName: string, listener: Function) {\n    const listeners = this._getListeners(eventName);\n    const index = listeners.indexOf(listener);\n    if (index > -1) {\n      listeners.splice(index, 1);\n    }\n  }\n\n  dispatchEvent(eventName: string, event: any) {\n    const listeners = this._getListeners(eventName);\n    for (let i = 0; i < listeners.length; i++) {\n      listeners[i](event);\n    }\n  }\n\n  private _getListeners(eventName: string): Function[] {\n    if (!this._listeners) {\n      this._listeners = new Map<string, Function[]>();\n    }\n    let listeners = this._listeners.get(eventName);\n    if (!listeners) {\n      listeners = [];\n      this._listeners.set(eventName, listeners);\n    }\n    return listeners;\n  }\n}\n\n\nfunction eventNameWithTarget(target: string, eventName: string): string {\n  return `${target}:${eventName}`;\n}\n\n@Injectable()\nexport class WebWorkerRendererFactory2 implements RendererFactory2 {\n  globalEvents = new NamedEventEmitter();\n\n  private _messageBroker: ClientMessageBroker;\n\n  constructor(\n      messageBrokerFactory: ClientMessageBrokerFactory, bus: MessageBus,\n      private _serializer: Serializer, public renderStore: RenderStore) {\n    this._messageBroker = messageBrokerFactory.createMessageBroker(RENDERER_2_CHANNEL);\n    bus.initChannel(EVENT_2_CHANNEL);\n    const source = bus.from(EVENT_2_CHANNEL);\n    source.subscribe({next: (message: any) => this._dispatchEvent(message)});\n  }\n\n  createRenderer(element: any, type: RendererType2|null): Renderer2 {\n    const renderer = new WebWorkerRenderer2(this);\n\n    const id = this.renderStore.allocateId();\n    this.renderStore.store(renderer, id);\n    this.callUI('createRenderer', [\n      new FnArg(element, SerializerTypes.RENDER_STORE_OBJECT),\n      new FnArg(type, SerializerTypes.RENDERER_TYPE_2),\n      new FnArg(renderer, SerializerTypes.RENDER_STORE_OBJECT),\n    ]);\n\n    return renderer;\n  }\n\n  begin() {}\n  end() {}\n\n  callUI(fnName: string, fnArgs: FnArg[]) {\n    const args = new UiArguments(fnName, fnArgs);\n    this._messageBroker.runOnService(args, null);\n  }\n\n  allocateNode(): WebWorkerRenderNode {\n    const result = new WebWorkerRenderNode();\n    const id = this.renderStore.allocateId();\n    this.renderStore.store(result, id);\n    return result;\n  }\n\n  freeNode(node: any) { this.renderStore.remove(node); }\n\n  allocateId(): number { return this.renderStore.allocateId(); }\n\n  private _dispatchEvent(message: {[key: string]: any}): void {\n    const element: WebWorkerRenderNode =\n        this._serializer.deserialize(message['element'], SerializerTypes.RENDER_STORE_OBJECT);\n\n    const eventName = message['eventName'];\n    const target = message['eventTarget'];\n    const event = message['event'];\n\n    if (target) {\n      this.globalEvents.dispatchEvent(eventNameWithTarget(target, eventName), event);\n    } else {\n      element.events.dispatchEvent(eventName, event);\n    }\n  }\n}\n\n\nexport class WebWorkerRenderer2 implements Renderer2 {\n  data: {[key: string]: any} = Object.create(null);\n\n  constructor(private _rendererFactory: WebWorkerRendererFactory2) {}\n\n  private asFnArg = new FnArg(this, SerializerTypes.RENDER_STORE_OBJECT);\n\n  destroy(): void { this.callUIWithRenderer('destroy'); }\n\n  destroyNode(node: any) {\n    this.callUIWithRenderer('destroyNode', [new FnArg(node, SerializerTypes.RENDER_STORE_OBJECT)]);\n    this._rendererFactory.freeNode(node);\n  }\n\n  createElement(name: string, namespace?: string): any {\n    const node = this._rendererFactory.allocateNode();\n    this.callUIWithRenderer('createElement', [\n      new FnArg(name),\n      new FnArg(namespace),\n      new FnArg(node, SerializerTypes.RENDER_STORE_OBJECT),\n    ]);\n    return node;\n  }\n\n  createComment(value: string): any {\n    const node = this._rendererFactory.allocateNode();\n    this.callUIWithRenderer('createComment', [\n      new FnArg(value),\n      new FnArg(node, SerializerTypes.RENDER_STORE_OBJECT),\n    ]);\n    return node;\n  }\n\n  createText(value: string): any {\n    const node = this._rendererFactory.allocateNode();\n    this.callUIWithRenderer('createText', [\n      new FnArg(value),\n      new FnArg(node, SerializerTypes.RENDER_STORE_OBJECT),\n    ]);\n    return node;\n  }\n\n  appendChild(parent: any, newChild: any): void {\n    this.callUIWithRenderer('appendChild', [\n      new FnArg(parent, SerializerTypes.RENDER_STORE_OBJECT),\n      new FnArg(newChild, SerializerTypes.RENDER_STORE_OBJECT),\n    ]);\n  }\n\n  insertBefore(parent: any, newChild: any, refChild: any): void {\n    if (!parent) {\n      return;\n    }\n\n    this.callUIWithRenderer('insertBefore', [\n      new FnArg(parent, SerializerTypes.RENDER_STORE_OBJECT),\n      new FnArg(newChild, SerializerTypes.RENDER_STORE_OBJECT),\n      new FnArg(refChild, SerializerTypes.RENDER_STORE_OBJECT),\n    ]);\n  }\n\n  removeChild(parent: any, oldChild: any): void {\n    this.callUIWithRenderer('removeChild', [\n      new FnArg(parent, SerializerTypes.RENDER_STORE_OBJECT),\n      new FnArg(oldChild, SerializerTypes.RENDER_STORE_OBJECT),\n    ]);\n  }\n\n  selectRootElement(selectorOrNode: string|any): any {\n    const node = this._rendererFactory.allocateNode();\n    this.callUIWithRenderer('selectRootElement', [\n      new FnArg(selectorOrNode),\n      new FnArg(node, SerializerTypes.RENDER_STORE_OBJECT),\n    ]);\n    return node;\n  }\n\n  parentNode(node: any): any {\n    const res = this._rendererFactory.allocateNode();\n    this.callUIWithRenderer('parentNode', [\n      new FnArg(node, SerializerTypes.RENDER_STORE_OBJECT),\n      new FnArg(res, SerializerTypes.RENDER_STORE_OBJECT),\n    ]);\n    return res;\n  }\n\n  nextSibling(node: any): any {\n    const res = this._rendererFactory.allocateNode();\n    this.callUIWithRenderer('nextSibling', [\n      new FnArg(node, SerializerTypes.RENDER_STORE_OBJECT),\n      new FnArg(res, SerializerTypes.RENDER_STORE_OBJECT),\n    ]);\n    return res;\n  }\n\n  setAttribute(el: any, name: string, value: string, namespace?: string): void {\n    this.callUIWithRenderer('setAttribute', [\n      new FnArg(el, SerializerTypes.RENDER_STORE_OBJECT),\n      new FnArg(name),\n      new FnArg(value),\n      new FnArg(namespace),\n    ]);\n  }\n\n  removeAttribute(el: any, name: string, namespace?: string): void {\n    this.callUIWithRenderer('removeAttribute', [\n      new FnArg(el, SerializerTypes.RENDER_STORE_OBJECT),\n      new FnArg(name),\n      new FnArg(namespace),\n    ]);\n  }\n\n  addClass(el: any, name: string): void {\n    this.callUIWithRenderer('addClass', [\n      new FnArg(el, SerializerTypes.RENDER_STORE_OBJECT),\n      new FnArg(name),\n    ]);\n  }\n\n  removeClass(el: any, name: string): void {\n    this.callUIWithRenderer('removeClass', [\n      new FnArg(el, SerializerTypes.RENDER_STORE_OBJECT),\n      new FnArg(name),\n    ]);\n  }\n\n  setStyle(el: any, style: string, value: any, flags: RendererStyleFlags2): void {\n    this.callUIWithRenderer('setStyle', [\n      new FnArg(el, SerializerTypes.RENDER_STORE_OBJECT),\n      new FnArg(style),\n      new FnArg(value),\n      new FnArg(flags),\n    ]);\n  }\n\n  removeStyle(el: any, style: string, flags: RendererStyleFlags2): void {\n    this.callUIWithRenderer('removeStyle', [\n      new FnArg(el, SerializerTypes.RENDER_STORE_OBJECT),\n      new FnArg(style),\n      new FnArg(flags),\n    ]);\n  }\n\n  setProperty(el: any, name: string, value: any): void {\n    this.callUIWithRenderer('setProperty', [\n      new FnArg(el, SerializerTypes.RENDER_STORE_OBJECT),\n      new FnArg(name),\n      new FnArg(value),\n    ]);\n  }\n\n  setValue(node: any, value: string): void {\n    this.callUIWithRenderer('setValue', [\n      new FnArg(node, SerializerTypes.RENDER_STORE_OBJECT),\n      new FnArg(value),\n    ]);\n  }\n\n  listen(\n      target: 'window'|'document'|'body'|any, eventName: string,\n      listener: (event: any) => boolean): () => void {\n    const unlistenId = this._rendererFactory.allocateId();\n\n    const [targetEl, targetName, fullName]: [any, string | null, string | null] =\n        typeof target === 'string' ? [null, target, `${target}:${eventName}`] :\n                                     [target, null, null];\n\n    if (fullName) {\n      this._rendererFactory.globalEvents.listen(fullName, listener);\n    } else {\n      targetEl.events.listen(eventName, listener);\n    }\n\n    this.callUIWithRenderer('listen', [\n      new FnArg(targetEl, SerializerTypes.RENDER_STORE_OBJECT),\n      new FnArg(targetName),\n      new FnArg(eventName),\n      new FnArg(unlistenId),\n    ]);\n\n    return () => {\n      if (fullName) {\n        this._rendererFactory.globalEvents.unlisten(fullName, listener);\n      } else {\n        targetEl.events.unlisten(eventName, listener);\n      }\n      this.callUIWithRenderer('unlisten', [new FnArg(unlistenId)]);\n    };\n  }\n\n  private callUIWithRenderer(fnName: string, fnArgs: FnArg[] = []) {\n    // always pass the renderer as the first arg\n    this._rendererFactory.callUI(fnName, [this.asFnArg, ...fnArgs]);\n  }\n}\n\nexport class WebWorkerRenderNode { events = new NamedEventEmitter(); }\n"]}