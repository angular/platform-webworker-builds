!function(global,factory){if("function"==typeof define&&define.amd)define("@angular/platform-webworker",["exports","@angular/common","@angular/core","@angular/platform-browser","rxjs/Subject","rxjs/Observable"],factory);else if("undefined"!=typeof exports)factory(exports,require("@angular/common"),require("@angular/core"),require("@angular/platform-browser"),require("rxjs/Subject"),require("rxjs/Observable"));else{var mod={exports:{}};factory(mod.exports,global.ng.common,global.ng.core,global.ng.platformBrowser,global.Rx,global.Rx),global.ng=global.ng||{},global.ng.platformWebworker=mod.exports}}(this,function(exports,_common,_core,_platformBrowser,_Subject2){"use strict";function _toArray(arr){return Array.isArray(arr)?arr:Array.from(arr)}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function stringify(t){if("string"==typeof t)return t;if(null==t)return""+t;if(t.overriddenName)return""+t.overriddenName;if(t.name)return""+t.name;var o=t.toString(),s=o.indexOf("\n");return-1===s?o:o.substring(0,s)}function serializeGenericEvent(t){return serializeEvent(t,EVENT_PROPERTIES)}function serializeEventWithTarget(t){var o=serializeEvent(t,EVENT_PROPERTIES);return addTarget(t,o)}function serializeMouseEvent(t){return serializeEvent(t,MOUSE_EVENT_PROPERTIES)}function serializeKeyboardEvent(t){var o=serializeEvent(t,KEYBOARD_EVENT_PROPERTIES);return addTarget(t,o)}function serializeTransitionEvent(t){var o=serializeEvent(t,TRANSITION_EVENT_PROPERTIES);return addTarget(t,o)}function addTarget(t,o){if(NODES_WITH_VALUE.has(t.target.tagName.toLowerCase())){var s=t.target;o.target={value:s.value},s.files&&(o.target.files=s.files)}return o}function serializeEvent(t,o){for(var s={},a=0;a<o.length;a++){var l=o[a];s[l]=t[l]}return s}function initializeGenericWorkerRenderer(t){var o=t.get(MessageBus),s=t.get(_core.NgZone);o.attachToZone(s);var a=t.get(WORKER_UI_STARTABLE_MESSAGING_SERVICE);s.runGuarded(function(){a.forEach(function(l){l.start()})})}function messageBusFactory(t){return t.bus}function initWebWorkerRenderPlatform(t){return function(){_platformBrowser.ɵBrowserDomAdapter.makeCurrent(),_platformBrowser.ɵBrowserGetTestability.init();var o=void 0;try{o=t.get(WORKER_SCRIPT)}catch(a){throw new Error("You must provide your WebWorker's initialization script with the WORKER_SCRIPT token")}var s=t.get(WebWorkerInstance);spawnWebWorker(o,s),initializeGenericWorkerRenderer(t)}}function _exceptionHandler(){return new _core.ErrorHandler}function _document(){return document}function createNgZone(){return new _core.NgZone({enableLongStackTrace:(0,_core.isDevMode)()})}function spawnWebWorker(t,o){var s=new Worker(t),a=new PostMessageBusSink(s),l=new PostMessageBusSource(s),d=new PostMessageBus(a,l);o.init(s,d)}function _resolveDefaultAnimationDriver(){return(0,_platformBrowser.ɵgetDOM)().supportsWebAnimation()?new _platformBrowser.ɵWebAnimationsDriver:_platformBrowser.AnimationDriver.NOOP}function initUiLocation(t){return function(){var o=t.get(_core.NgZone);o.runGuarded(function(){return t.get(MessageBasedPlatformLocation).start()})}}function appInitFnFactory(t,o){return function(){return o.runGuarded(function(){return t.init()})}}function eventNameWithTarget(t,o){return t+":"+o}function errorHandler(){return new _core.ErrorHandler}function createMessageBus(t){var o=new PostMessageBusSink(_postMessage),s=new PostMessageBusSource,a=new PostMessageBus(o,s);return a.attachToZone(t),a}function setupWebWorker(){WorkerDomAdapter.makeCurrent()}function bootstrapWorkerUi(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],s=platformWorkerUi([{provide:WORKER_SCRIPT,useValue:t}].concat(_toConsumableArray(o)));return Promise.resolve(s)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.ɵg=exports.ɵf=exports.ɵd=exports.ɵe=exports.ɵi=exports.ɵj=exports.ɵc=exports.ɵb=exports.ɵh=exports.ɵa=exports.ɵk=exports.bootstrapWorkerUi=exports.platformWorkerUi=exports.platformWorkerApp=exports.WorkerAppModule=exports.WORKER_APP_LOCATION_PROVIDERS=exports.WORKER_UI_LOCATION_PROVIDERS=exports.ServiceMessageBrokerFactory=exports.ServiceMessageBroker=exports.PRIMITIVE=exports.MessageBus=exports.UiArguments=exports.FnArg=exports.ClientMessageBrokerFactory=exports.ClientMessageBroker=exports.VERSION=void 0;var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{!_n&&_i.return&&_i.return()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr))return arr;if(Symbol.iterator in Object(arr))return sliceIterator(arr,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_get=function get(object,property,receiver){null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc)return desc.value;var getter=desc.get;if(void 0!==getter)return getter.call(receiver)},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),ON_WEB_WORKER=new _core.InjectionToken("WebWorker.onWebWorker"),MessageBus=function(){function MessageBus(){_classCallCheck(this,MessageBus)}return _createClass(MessageBus,[{key:"initChannel",value:function(){}},{key:"attachToZone",value:function(){}},{key:"from",value:function(){}},{key:"to",value:function(){}}]),MessageBus}(),RenderStore=function(){function RenderStore(){_classCallCheck(this,RenderStore),this._nextIndex=0,this._lookupById=new Map,this._lookupByObject=new Map}return _createClass(RenderStore,[{key:"allocateId",value:function(){return this._nextIndex++}},{key:"store",value:function(t,o){null==o||(this._lookupById.set(o,t),this._lookupByObject.set(t,o))}},{key:"remove",value:function(t){var o=this._lookupByObject.get(t);null!=o&&(this._lookupByObject.delete(t),this._lookupById.delete(o))}},{key:"deserialize",value:function(t){return this._lookupById.has(t)?this._lookupById.get(t):null}},{key:"serialize",value:function(t){return null==t?null:this._lookupByObject.get(t)}}]),RenderStore}();RenderStore.decorators=[{type:_core.Injectable}],RenderStore.ctorParameters=function(){return[]};var PRIMITIVE=1,LocationType=function LocationType(t,o,s,a,l,d,m,c,_){_classCallCheck(this,LocationType),this.href=t,this.protocol=o,this.host=s,this.hostname=a,this.port=l,this.pathname=d,this.search=m,this.hash=c,this.origin=_},Serializer=function(){function Serializer(t){_classCallCheck(this,Serializer),this._renderStore=t}return _createClass(Serializer,[{key:"serialize",value:function(t){var _this=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(null==t||1===o)return t;if(Array.isArray(t))return t.map(function(s){return _this.serialize(s,o)});if(2===o)return this._renderStore.serialize(t);if(o===_core.RenderComponentType)return this._serializeRenderComponentType(t);if(0===o)return this._serializeRendererTypeV2(t);if(o===LocationType)return this._serializeLocation(t);throw new Error("No serializer for type "+stringify(o))}},{key:"deserialize",value:function(t){var _this2=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=arguments[2];if(null==t||1===o)return t;if(Array.isArray(t))return t.map(function(a){return _this2.deserialize(a,o,s)});if(2===o)return this._renderStore.deserialize(t);if(o===_core.RenderComponentType)return this._deserializeRenderComponentType(t);if(0===o)return this._deserializeRendererTypeV2(t);if(o===LocationType)return this._deserializeLocation(t);throw new Error("No deserializer for type "+stringify(o))}},{key:"_serializeLocation",value:function(t){return{href:t.href,protocol:t.protocol,host:t.host,hostname:t.hostname,port:t.port,pathname:t.pathname,search:t.search,hash:t.hash,origin:t.origin}}},{key:"_deserializeLocation",value:function(t){return new LocationType(t.href,t.protocol,t.host,t.hostname,t.port,t.pathname,t.search,t.hash,t.origin)}},{key:"_serializeRenderComponentType",value:function(t){return{id:t.id,templateUrl:t.templateUrl,slotCount:t.slotCount,encapsulation:this.serialize(t.encapsulation),styles:this.serialize(t.styles)}}},{key:"_deserializeRenderComponentType",value:function(t){return new _core.RenderComponentType(t.id,t.templateUrl,t.slotCount,this.deserialize(t.encapsulation),this.deserialize(t.styles),{})}},{key:"_serializeRendererTypeV2",value:function(t){return{id:t.id,encapsulation:this.serialize(t.encapsulation),styles:this.serialize(t.styles),data:this.serialize(t.data)}}},{key:"_deserializeRendererTypeV2",value:function(t){return{id:t.id,encapsulation:t.encapsulation,styles:this.deserialize(t.styles),data:this.deserialize(t.data)}}}]),Serializer}();Serializer.decorators=[{type:_core.Injectable}],Serializer.ctorParameters=function(){return[{type:RenderStore}]};var ANIMATION_WORKER_PLAYER_PREFIX="AnimationPlayer.",ClientMessageBrokerFactory=function(){function ClientMessageBrokerFactory(){_classCallCheck(this,ClientMessageBrokerFactory)}return _createClass(ClientMessageBrokerFactory,[{key:"createMessageBroker",value:function(){}}]),ClientMessageBrokerFactory}(),ClientMessageBrokerFactory_=function(_ClientMessageBrokerF){function ClientMessageBrokerFactory_(t,o){var _this3;return _classCallCheck(this,ClientMessageBrokerFactory_),_this3=_possibleConstructorReturn(this,(ClientMessageBrokerFactory_.__proto__||Object.getPrototypeOf(ClientMessageBrokerFactory_)).call(this)),_this3._messageBus=t,_this3._serializer=o,_this3}return _inherits(ClientMessageBrokerFactory_,_ClientMessageBrokerF),_createClass(ClientMessageBrokerFactory_,[{key:"createMessageBroker",value:function(t){var o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._messageBus.initChannel(t,o),new ClientMessageBroker_(this._messageBus,this._serializer,t)}}]),ClientMessageBrokerFactory_}(ClientMessageBrokerFactory);ClientMessageBrokerFactory_.decorators=[{type:_core.Injectable}],ClientMessageBrokerFactory_.ctorParameters=function(){return[{type:MessageBus},{type:Serializer}]};var ClientMessageBroker=function(){function ClientMessageBroker(){_classCallCheck(this,ClientMessageBroker)}return _createClass(ClientMessageBroker,[{key:"runOnService",value:function(){}}]),ClientMessageBroker}(),ClientMessageBroker_=function(_ClientMessageBroker){function ClientMessageBroker_(t,o,s){var _this4;_classCallCheck(this,ClientMessageBroker_),_this4=_possibleConstructorReturn(this,(ClientMessageBroker_.__proto__||Object.getPrototypeOf(ClientMessageBroker_)).call(this)),_this4.channel=s,_this4._pending=new Map,_this4._sink=t.to(s),_this4._serializer=o;var a=t.from(s);return a.subscribe({next:function(l){return _this4._handleMessage(l)}}),_this4}return _inherits(ClientMessageBroker_,_ClientMessageBroker),_createClass(ClientMessageBroker_,[{key:"_generateMessageId",value:function(t){for(var o=stringify((new Date).getTime()),s=0,a=t+o+stringify(s);this._pending.has(a);)a=""+t+o+s,s++;return a}},{key:"runOnService",value:function(t,o){var _this5=this,s=[];t.args&&t.args.forEach(function(m){null==m.type?s.push(m.value):s.push(_this5._serializer.serialize(m.value,m.type))});var a=void 0,l=null;if(null!=o){var m=void 0;a=new Promise(function(c,_){m={resolve:c,reject:_}}),l=this._generateMessageId(t.method),this._pending.set(l,m),a.catch(function(c){console&&console.error&&console.error(c),m.reject(c)}),a=a.then(function(c){return _this5._serializer?_this5._serializer.deserialize(c,o):c})}else a=null;var d={method:t.method,args:s};return null!=l&&(d.id=l),this._sink.emit(d),a}},{key:"_handleMessage",value:function(t){if("result"===t.type||"error"===t.type){var o=t.id;this._pending.has(o)&&("result"===t.type?this._pending.get(o).resolve(t.value):this._pending.get(o).reject(t.value),this._pending.delete(o))}}}]),ClientMessageBroker_}(ClientMessageBroker),FnArg=function FnArg(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;_classCallCheck(this,FnArg),this.value=t,this.type=o},UiArguments=function UiArguments(t,o){_classCallCheck(this,UiArguments),this.method=t,this.args=o},EventEmitter=function(_Subject){function EventEmitter(){var _this6,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return _classCallCheck(this,EventEmitter),_this6=_possibleConstructorReturn(this,(EventEmitter.__proto__||Object.getPrototypeOf(EventEmitter)).call(this)),_this6.__isAsync=t,_this6}return _inherits(EventEmitter,_Subject),_createClass(EventEmitter,[{key:"emit",value:function(t){_get(EventEmitter.prototype.__proto__||Object.getPrototypeOf(EventEmitter.prototype),"next",this).call(this,t)}},{key:"subscribe",value:function(t,o,s){var a=void 0,l=function(){return null},d=function(){return null};return t&&"object"==("undefined"==typeof t?"undefined":_typeof(t))?(a=this.__isAsync?function(m){setTimeout(function(){return t.next(m)})}:function(m){t.next(m)},t.error&&(l=this.__isAsync?function(m){setTimeout(function(){return t.error(m)})}:function(m){t.error(m)}),t.complete&&(d=this.__isAsync?function(){setTimeout(function(){return t.complete()})}:function(){t.complete()})):(a=this.__isAsync?function(m){setTimeout(function(){return t(m)})}:function(m){t(m)},o&&(l=this.__isAsync?function(m){setTimeout(function(){return o(m)})}:function(m){o(m)}),s&&(d=this.__isAsync?function(){setTimeout(function(){return s()})}:function(){s()})),_get(EventEmitter.prototype.__proto__||Object.getPrototypeOf(EventEmitter.prototype),"subscribe",this).call(this,a,l,d)}}]),EventEmitter}(_Subject2.Subject),PostMessageBusSink=function(){function PostMessageBusSink(t){_classCallCheck(this,PostMessageBusSink),this._postMessageTarget=t,this._channels={},this._messageBuffer=[]}return _createClass(PostMessageBusSink,[{key:"attachToZone",value:function(t){var _this7=this;this._zone=t,this._zone.runOutsideAngular(function(){_this7._zone.onStable.subscribe({next:function(){_this7._handleOnEventDone()}})})}},{key:"initChannel",value:function(t){var _this8=this,o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this._channels.hasOwnProperty(t))throw new Error(t+" has already been initialized");var s=new EventEmitter((!1)),a=new _Channel(s,o);this._channels[t]=a,s.subscribe(function(l){var d={channel:t,message:l};o?_this8._messageBuffer.push(d):_this8._sendMessages([d])})}},{key:"to",value:function(t){if(this._channels.hasOwnProperty(t))return this._channels[t].emitter;throw new Error(t+" is not set up. Did you forget to call initChannel?")}},{key:"_handleOnEventDone",value:function(){0<this._messageBuffer.length&&(this._sendMessages(this._messageBuffer),this._messageBuffer=[])}},{key:"_sendMessages",value:function(t){this._postMessageTarget.postMessage(t)}}]),PostMessageBusSink}(),PostMessageBusSource=function(){function PostMessageBusSource(t){var _this9=this;if(_classCallCheck(this,PostMessageBusSource),this._channels={},t)t.addEventListener("message",function(o){return _this9._handleMessages(o)});else{var o=self;o.addEventListener("message",function(s){return _this9._handleMessages(s)})}}return _createClass(PostMessageBusSource,[{key:"attachToZone",value:function(t){this._zone=t}},{key:"initChannel",value:function(t){var o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this._channels.hasOwnProperty(t))throw new Error(t+" has already been initialized");var s=new EventEmitter((!1)),a=new _Channel(s,o);this._channels[t]=a}},{key:"from",value:function(t){if(this._channels.hasOwnProperty(t))return this._channels[t].emitter;throw new Error(t+" is not set up. Did you forget to call initChannel?")}},{key:"_handleMessages",value:function(t){for(var o=t.data,s=0;s<o.length;s++)this._handleMessage(o[s])}},{key:"_handleMessage",value:function(t){var o=t.channel;if(this._channels.hasOwnProperty(o)){var s=this._channels[o];s.runInZone?this._zone.run(function(){s.emitter.emit(t.message)}):s.emitter.emit(t.message)}}}]),PostMessageBusSource}(),PostMessageBus=function(){function PostMessageBus(t,o){_classCallCheck(this,PostMessageBus),this.sink=t,this.source=o}return _createClass(PostMessageBus,[{key:"attachToZone",value:function(t){this.source.attachToZone(t),this.sink.attachToZone(t)}},{key:"initChannel",value:function(t){var o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.source.initChannel(t,o),this.sink.initChannel(t,o)}},{key:"from",value:function(t){return this.source.from(t)}},{key:"to",value:function(t){return this.sink.to(t)}}]),PostMessageBus}();PostMessageBus.decorators=[{type:_core.Injectable}],PostMessageBus.ctorParameters=function(){return[{type:PostMessageBusSink},{type:PostMessageBusSource}]};var _Channel=function _Channel(t,o){_classCallCheck(this,_Channel),this.emitter=t,this.runInZone=o},ServiceMessageBrokerFactory=function(){function ServiceMessageBrokerFactory(){_classCallCheck(this,ServiceMessageBrokerFactory)}return _createClass(ServiceMessageBrokerFactory,[{key:"createMessageBroker",value:function(){}}]),ServiceMessageBrokerFactory}(),ServiceMessageBrokerFactory_=function(_ServiceMessageBroker){function ServiceMessageBrokerFactory_(t,o){var _this10;return _classCallCheck(this,ServiceMessageBrokerFactory_),_this10=_possibleConstructorReturn(this,(ServiceMessageBrokerFactory_.__proto__||Object.getPrototypeOf(ServiceMessageBrokerFactory_)).call(this)),_this10._messageBus=t,_this10._serializer=o,_this10}return _inherits(ServiceMessageBrokerFactory_,_ServiceMessageBroker),_createClass(ServiceMessageBrokerFactory_,[{key:"createMessageBroker",value:function(t){var o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._messageBus.initChannel(t,o),new ServiceMessageBroker_(this._messageBus,this._serializer,t)}}]),ServiceMessageBrokerFactory_}(ServiceMessageBrokerFactory);ServiceMessageBrokerFactory_.decorators=[{type:_core.Injectable}],ServiceMessageBrokerFactory_.ctorParameters=function(){return[{type:MessageBus},{type:Serializer}]};var ServiceMessageBroker=function(){function ServiceMessageBroker(){_classCallCheck(this,ServiceMessageBroker)}return _createClass(ServiceMessageBroker,[{key:"registerMethod",value:function(){}}]),ServiceMessageBroker}(),ServiceMessageBroker_=function(_ServiceMessageBroker2){function ServiceMessageBroker_(t,o,s){var _this11;_classCallCheck(this,ServiceMessageBroker_),_this11=_possibleConstructorReturn(this,(ServiceMessageBroker_.__proto__||Object.getPrototypeOf(ServiceMessageBroker_)).call(this)),_this11._serializer=o,_this11.channel=s,_this11._methods=new Map,_this11._sink=t.to(s);var a=t.from(s);return a.subscribe({next:function(l){return _this11._handleMessage(l)}}),_this11}return _inherits(ServiceMessageBroker_,_ServiceMessageBroker2),_createClass(ServiceMessageBroker_,[{key:"registerMethod",value:function(t,o,s,a){var _this12=this;this._methods.set(t,function(l){for(var d=l.args,m=o?o.length:0,c=Array(m),u=0;u<m;u++){var h=d[u];c[u]=_this12._serializer.deserialize(h,o[u])}var _=s.apply(void 0,_toConsumableArray(c));a&&_&&_this12._wrapWebWorkerPromise(l.id,_,a)})}},{key:"_handleMessage",value:function(t){this._methods.has(t.method)&&this._methods.get(t.method)(t)}},{key:"_wrapWebWorkerPromise",value:function(t,o,s){var _this13=this;o.then(function(a){_this13._sink.emit({type:"result",value:_this13._serializer.serialize(a,s),id:t})})}}]),ServiceMessageBroker_}(ServiceMessageBroker),RENDERER_CHANNEL="ng-Renderer",EVENT_CHANNEL="ng-Events",RENDERER_V2_CHANNEL="v2.ng-Renderer",EVENT_V2_CHANNEL="v2.ng-Events",ROUTER_CHANNEL="ng-Router",MOUSE_EVENT_PROPERTIES=["altKey","button","clientX","clientY","metaKey","movementX","movementY","offsetX","offsetY","region","screenX","screenY","shiftKey"],KEYBOARD_EVENT_PROPERTIES=["altkey","charCode","code","ctrlKey","isComposing","key","keyCode","location","metaKey","repeat","shiftKey","which"],TRANSITION_EVENT_PROPERTIES=["propertyName","elapsedTime","pseudoElement"],EVENT_PROPERTIES=["type","bubbles","cancelable"],NODES_WITH_VALUE=new Set(["input","select","option","button","li","meter","progress","param","textarea"]),EventDispatcher=function(){function EventDispatcher(t,o){_classCallCheck(this,EventDispatcher),this._sink=t,this._serializer=o}return _createClass(EventDispatcher,[{key:"dispatchAnimationEvent",value:function(t,o,s){return this._sink.emit({element:this._serializer.serialize(s,2),animationPlayer:this._serializer.serialize(t,2),phaseName:o}),!0}},{key:"dispatchRenderEvent",value:function(t,o,s,a){var l=void 0;switch(a.type){case"click":case"mouseup":case"mousedown":case"dblclick":case"contextmenu":case"mouseenter":case"mouseleave":case"mousemove":case"mouseout":case"mouseover":case"show":l=serializeMouseEvent(a);break;case"keydown":case"keypress":case"keyup":l=serializeKeyboardEvent(a);break;case"input":case"change":case"blur":l=serializeEventWithTarget(a);break;case"abort":case"afterprint":case"beforeprint":case"cached":case"canplay":case"canplaythrough":case"chargingchange":case"chargingtimechange":case"close":case"dischargingtimechange":case"DOMContentLoaded":case"downloading":case"durationchange":case"emptied":case"ended":case"error":case"fullscreenchange":case"fullscreenerror":case"invalid":case"languagechange":case"levelfchange":case"loadeddata":case"loadedmetadata":case"obsolete":case"offline":case"online":case"open":case"orientatoinchange":case"pause":case"pointerlockchange":case"pointerlockerror":case"play":case"playing":case"ratechange":case"readystatechange":case"reset":case"scroll":case"seeked":case"seeking":case"stalled":case"submit":case"success":case"suspend":case"timeupdate":case"updateready":case"visibilitychange":case"volumechange":case"waiting":l=serializeGenericEvent(a);break;case"transitionend":l=serializeTransitionEvent(a);break;default:throw new Error(s+" not supported on WebWorkers")}return this._sink.emit({element:this._serializer.serialize(t,2),eventName:s,eventTarget:o,event:l}),!1}}]),EventDispatcher}(),MessageBasedRenderer=function(){function MessageBasedRenderer(t,o,s,a,l){_classCallCheck(this,MessageBasedRenderer),this._brokerFactory=t,this._bus=o,this._serializer=s,this._renderStore=a,this._rootRenderer=l}return _createClass(MessageBasedRenderer,[{key:"start",value:function(){var _this14=this,t=this._brokerFactory.createMessageBroker(RENDERER_CHANNEL);this._bus.initChannel(EVENT_CHANNEL),this._eventDispatcher=new EventDispatcher(this._bus.to(EVENT_CHANNEL),this._serializer);var o=_core.RenderComponentType,s=2,a=1,l=[["renderComponent",this._renderComponent,o,a],["selectRootElement",this._selectRootElement,s,a,a],["createElement",this._createElement,s,s,a,a],["createViewRoot",this._createViewRoot,s,s,a],["createTemplateAnchor",this._createTemplateAnchor,s,s,a],["createText",this._createText,s,s,a,a],["projectNodes",this._projectNodes,s,s,s],["attachViewAfter",this._attachViewAfter,s,s,s],["detachView",this._detachView,s,s],["destroyView",this._destroyView,s,s,s],["setElementProperty",this._setElementProperty,s,s,a,a],["setElementAttribute",this._setElementAttribute,s,s,a,a],["setBindingDebugInfo",this._setBindingDebugInfo,s,s,a,a],["setElementClass",this._setElementClass,s,s,a,a],["setElementStyle",this._setElementStyle,s,s,a,a],["invokeElementMethod",this._invokeElementMethod,s,s,a,a],["setText",this._setText,s,s,a],["listen",this._listen,s,s,a,a],["listenGlobal",this._listenGlobal,s,a,a,a],["listenDone",this._listenDone,s,s],["animate",this._animate,s,s,a,a,a,a,a,a,a]];l.forEach(function(_ref){var _ref2=_toArray(_ref),d=_ref2[0],m=_ref2[1],c=_ref2.slice(2);t.registerMethod(d,c,m.bind(_this14))}),this._bindAnimationPlayerMethods(t)}},{key:"_bindAnimationPlayerMethods",value:function(t){var _this15=this,o=1,s=2;t.registerMethod(ANIMATION_WORKER_PLAYER_PREFIX+"play",[s,s],function(a){return a.play()}),t.registerMethod(ANIMATION_WORKER_PLAYER_PREFIX+"pause",[s,s],function(a){return a.pause()}),t.registerMethod(ANIMATION_WORKER_PLAYER_PREFIX+"init",[s,s],function(a){return a.init()}),t.registerMethod(ANIMATION_WORKER_PLAYER_PREFIX+"restart",[s,s],function(a){return a.restart()}),t.registerMethod(ANIMATION_WORKER_PLAYER_PREFIX+"destroy",[s,s],function(a){a.destroy(),_this15._renderStore.remove(a)}),t.registerMethod(ANIMATION_WORKER_PLAYER_PREFIX+"finish",[s,s],function(a){return a.finish()}),t.registerMethod(ANIMATION_WORKER_PLAYER_PREFIX+"getPosition",[s,s],function(a){return a.getPosition()}),t.registerMethod(ANIMATION_WORKER_PLAYER_PREFIX+"onStart",[s,s,o],function(a,l){return _this15._listenOnAnimationPlayer(a,l,"onStart")}),t.registerMethod(ANIMATION_WORKER_PLAYER_PREFIX+"onDone",[s,s,o],function(a,l){return _this15._listenOnAnimationPlayer(a,l,"onDone")}),t.registerMethod(ANIMATION_WORKER_PLAYER_PREFIX+"setPosition",[s,s,o],function(a,l,d){return a.setPosition(d)})}},{key:"_renderComponent",value:function(t,o){var s=this._rootRenderer.renderComponent(t);this._renderStore.store(s,o)}},{key:"_selectRootElement",value:function(t,o,s){this._renderStore.store(t.selectRootElement(o,null),s)}},{key:"_createElement",value:function(t,o,s,a){this._renderStore.store(t.createElement(o,s,null),a)}},{key:"_createViewRoot",value:function(t,o,s){var a=t.createViewRoot(o);this._renderStore.serialize(o)!==s&&this._renderStore.store(a,s)}},{key:"_createTemplateAnchor",value:function(t,o,s){this._renderStore.store(t.createTemplateAnchor(o,null),s)}},{key:"_createText",value:function(t,o,s,a){this._renderStore.store(t.createText(o,s,null),a)}},{key:"_projectNodes",value:function(t,o,s){t.projectNodes(o,s)}},{key:"_attachViewAfter",value:function(t,o,s){t.attachViewAfter(o,s)}},{key:"_detachView",value:function(t,o){t.detachView(o)}},{key:"_destroyView",value:function(t,o,s){t.destroyView(o,s);for(var a=0;a<s.length;a++)this._renderStore.remove(s[a])}},{key:"_setElementProperty",value:function(t,o,s,a){t.setElementProperty(o,s,a)}},{key:"_setElementAttribute",value:function(t,o,s,a){t.setElementAttribute(o,s,a)}},{key:"_setBindingDebugInfo",value:function(t,o,s,a){t.setBindingDebugInfo(o,s,a)}},{key:"_setElementClass",value:function(t,o,s,a){t.setElementClass(o,s,a)}},{key:"_setElementStyle",value:function(t,o,s,a){t.setElementStyle(o,s,a)}},{key:"_invokeElementMethod",value:function(t,o,s,a){t.invokeElementMethod(o,s,a)}},{key:"_setText",value:function(t,o,s){t.setText(o,s)}},{key:"_listen",value:function(t,o,s,a){var _this16=this,l=t.listen(o,s,function(d){return _this16._eventDispatcher.dispatchRenderEvent(o,null,s,d)});this._renderStore.store(l,a)}},{key:"_listenGlobal",value:function(t,o,s,a){var _this17=this,l=t.listenGlobal(o,s,function(d){return _this17._eventDispatcher.dispatchRenderEvent(null,o,s,d)});this._renderStore.store(l,a)}},{key:"_listenDone",value:function(t,o){o()}},{key:"_animate",value:function(t,o,s,a,l,d,m,c,_){var _this18=this,u=void 0;c&&c.length&&(u=c.map(function(g){return _this18._renderStore.deserialize(g)}));var h=t.animate(o,s,a,l,d,m,u);this._renderStore.store(h,_)}},{key:"_listenOnAnimationPlayer",value:function(t,o,s){var _this19=this,a=function(){_this19._eventDispatcher.dispatchAnimationEvent(t,s,o)};"onDone"==s?t.onDone(function(){return a()}):t.onStart(function(){return a()})}}]),MessageBasedRenderer}();MessageBasedRenderer.decorators=[{type:_core.Injectable}],MessageBasedRenderer.ctorParameters=function(){return[{type:ServiceMessageBrokerFactory},{type:MessageBus},{type:Serializer},{type:RenderStore},{type:_core.RootRenderer}]};var MessageBasedRendererV2=function(){function MessageBasedRendererV2(t,o,s,a,l){_classCallCheck(this,MessageBasedRendererV2),this._brokerFactory=t,this._bus=o,this._serializer=s,this._renderStore=a,this._rendererFactory=l}return _createClass(MessageBasedRendererV2,[{key:"start",value:function(){var _this20=this,t=this._brokerFactory.createMessageBroker(RENDERER_V2_CHANNEL);this._bus.initChannel(EVENT_V2_CHANNEL),this._eventDispatcher=new EventDispatcher(this._bus.to(EVENT_V2_CHANNEL),this._serializer);var o=2,s=1,a=0,l=[["createRenderer",this.createRenderer,o,a,s],["createElement",this.createElement,o,s,s,s],["createComment",this.createComment,o,s,s],["createText",this.createText,o,s,s],["appendChild",this.appendChild,o,o,o],["insertBefore",this.insertBefore,o,o,o,o],["removeChild",this.removeChild,o,o,o],["selectRootElement",this.selectRootElement,o,s,s],["parentNode",this.parentNode,o,o,s],["nextSibling",this.nextSibling,o,o,s],["setAttribute",this.setAttribute,o,o,s,s,s],["removeAttribute",this.removeAttribute,o,o,s,s],["addClass",this.addClass,o,o,s],["removeClass",this.removeClass,o,o,s],["setStyle",this.setStyle,o,o,s,s,s,s],["removeStyle",this.removeStyle,o,o,s,s],["setProperty",this.setProperty,o,o,s,s],["setValue",this.setValue,o,o,s],["listen",this.listen,o,o,s,s,s],["unlisten",this.unlisten,o,o],["destroy",this.destroy,o],["destroyNode",this.destroyNode,o,s]];l.forEach(function(_ref3){var _ref4=_toArray(_ref3),d=_ref4[0],m=_ref4[1],c=_ref4.slice(2);t.registerMethod(d,c,m.bind(_this20))})}},{key:"destroy",value:function(t){t.destroy()}},{key:"destroyNode",value:function(t,o){t.destroyNode&&t.destroyNode(o),this._renderStore.remove(o)}},{key:"createRenderer",value:function(t,o,s){this._renderStore.store(this._rendererFactory.createRenderer(t,o),s)}},{key:"createElement",value:function(t,o,s,a){this._renderStore.store(t.createElement(o,s),a)}},{key:"createComment",value:function(t,o,s){this._renderStore.store(t.createComment(o),s)}},{key:"createText",value:function(t,o,s){this._renderStore.store(t.createText(o),s)}},{key:"appendChild",value:function(t,o,s){t.appendChild(o,s)}},{key:"insertBefore",value:function(t,o,s,a){t.insertBefore(o,s,a)}},{key:"removeChild",value:function(t,o,s){t.removeChild(o,s)}},{key:"selectRootElement",value:function(t,o,s){this._renderStore.store(t.selectRootElement(o),s)}},{key:"parentNode",value:function(t,o,s){this._renderStore.store(t.parentNode(o),s)}},{key:"nextSibling",value:function(t,o,s){this._renderStore.store(t.nextSibling(o),s)}},{key:"setAttribute",value:function(t,o,s,a,l){t.setAttribute(o,s,a,l)}},{key:"removeAttribute",value:function(t,o,s,a){t.removeAttribute(o,s,a)}},{key:"addClass",value:function(t,o,s){t.addClass(o,s)}},{key:"removeClass",value:function(t,o,s){t.removeClass(o,s)}},{key:"setStyle",value:function(t,o,s,a,l,d){t.setStyle(o,s,a,l,d)}},{key:"removeStyle",value:function(t,o,s,a){t.removeStyle(o,s,a)}},{key:"setProperty",value:function(t,o,s,a){t.setProperty(o,s,a)}},{key:"setValue",value:function(t,o,s){t.setValue(o,s)}},{key:"listen",value:function(t,o,s,a,l){var _this21=this,m=t.listen(o||s,a,function(c){
return _this21._eventDispatcher.dispatchRenderEvent(o,s,a,c)});this._renderStore.store(m,l)}},{key:"unlisten",value:function(t,o){o()}}]),MessageBasedRendererV2}();MessageBasedRendererV2.decorators=[{type:_core.Injectable}],MessageBasedRendererV2.ctorParameters=function(){return[{type:ServiceMessageBrokerFactory},{type:MessageBus},{type:Serializer},{type:RenderStore},{type:_core.RendererFactoryV2}]};var WebWorkerInstance=function(){function WebWorkerInstance(){_classCallCheck(this,WebWorkerInstance)}return _createClass(WebWorkerInstance,[{key:"init",value:function(t,o){this.worker=t,this.bus=o}}]),WebWorkerInstance}();WebWorkerInstance.decorators=[{type:_core.Injectable}],WebWorkerInstance.ctorParameters=function(){return[]};var WORKER_SCRIPT=new _core.InjectionToken("WebWorkerScript"),WORKER_UI_STARTABLE_MESSAGING_SERVICE=new _core.InjectionToken("WorkerRenderStartableMsgService"),_WORKER_UI_PLATFORM_PROVIDERS=[{provide:_core.NgZone,useFactory:createNgZone,deps:[]},MessageBasedRenderer,MessageBasedRendererV2,{provide:WORKER_UI_STARTABLE_MESSAGING_SERVICE,useExisting:MessageBasedRendererV2,multi:!0},_platformBrowser.ɵBROWSER_SANITIZATION_PROVIDERS,{provide:_core.ErrorHandler,useFactory:_exceptionHandler,deps:[]},{provide:_platformBrowser.DOCUMENT,useFactory:_document,deps:[]},{provide:_platformBrowser.EVENT_MANAGER_PLUGINS,useClass:_platformBrowser.ɵDomEventsPlugin,multi:!0},{provide:_platformBrowser.EVENT_MANAGER_PLUGINS,useClass:_platformBrowser.ɵKeyEventsPlugin,multi:!0},{provide:_platformBrowser.EVENT_MANAGER_PLUGINS,useClass:_platformBrowser.ɵHammerGesturesPlugin,multi:!0},{provide:_platformBrowser.HAMMER_GESTURE_CONFIG,useClass:_platformBrowser.HammerGestureConfig},_core.ɵAPP_ID_RANDOM_PROVIDER,{provide:_platformBrowser.ɵDomRootRenderer,useClass:_platformBrowser.ɵDomRootRenderer_},{provide:_core.RootRenderer,useExisting:_platformBrowser.ɵDomRootRenderer},_platformBrowser.ɵDomRendererFactoryV2,{provide:_core.RendererFactoryV2,useExisting:_platformBrowser.ɵDomRendererFactoryV2},{provide:_platformBrowser.ɵSharedStylesHost,useExisting:_platformBrowser.ɵDomSharedStylesHost},{provide:ServiceMessageBrokerFactory,useClass:ServiceMessageBrokerFactory_},{provide:ClientMessageBrokerFactory,useClass:ClientMessageBrokerFactory_},{provide:_platformBrowser.AnimationDriver,useFactory:_resolveDefaultAnimationDriver,deps:[]},Serializer,{provide:ON_WEB_WORKER,useValue:!1},RenderStore,_platformBrowser.ɵDomSharedStylesHost,_core.Testability,_platformBrowser.EventManager,WebWorkerInstance,{provide:_core.PLATFORM_INITIALIZER,useFactory:initWebWorkerRenderPlatform,multi:!0,deps:[_core.Injector]},{provide:_core.PLATFORM_ID,useValue:_common.ɵPLATFORM_WORKER_UI_ID},{provide:MessageBus,useFactory:messageBusFactory,deps:[WebWorkerInstance]}],platformWorkerUi=(0,_core.createPlatformFactory)(_core.platformCore,"workerUi",_WORKER_UI_PLATFORM_PROVIDERS),VERSION=new _core.Version("4.0.0-beta.8-e99d721"),MessageBasedPlatformLocation=function(){function MessageBasedPlatformLocation(t,o,s,a){_classCallCheck(this,MessageBasedPlatformLocation),this._brokerFactory=t,this._platformLocation=o,this._serializer=a,this._platformLocation.onPopState(this._sendUrlChangeEvent.bind(this)),this._platformLocation.onHashChange(this._sendUrlChangeEvent.bind(this)),this._broker=this._brokerFactory.createMessageBroker(ROUTER_CHANNEL),this._channelSink=s.to(ROUTER_CHANNEL)}return _createClass(MessageBasedPlatformLocation,[{key:"start",value:function(){var t=1;this._broker.registerMethod("getLocation",null,this._getLocation.bind(this),LocationType),this._broker.registerMethod("setPathname",[t],this._setPathname.bind(this)),this._broker.registerMethod("pushState",[t,t,t],this._platformLocation.pushState.bind(this._platformLocation)),this._broker.registerMethod("replaceState",[t,t,t],this._platformLocation.replaceState.bind(this._platformLocation)),this._broker.registerMethod("forward",null,this._platformLocation.forward.bind(this._platformLocation)),this._broker.registerMethod("back",null,this._platformLocation.back.bind(this._platformLocation))}},{key:"_getLocation",value:function(){return Promise.resolve(this._platformLocation.location)}},{key:"_sendUrlChangeEvent",value:function(t){this._channelSink.emit({event:{type:t.type},location:this._serializer.serialize(this._platformLocation.location,LocationType)})}},{key:"_setPathname",value:function(t){this._platformLocation.pathname=t}}]),MessageBasedPlatformLocation}();MessageBasedPlatformLocation.decorators=[{type:_core.Injectable}],MessageBasedPlatformLocation.ctorParameters=function(){return[{type:ServiceMessageBrokerFactory},{type:_platformBrowser.ɵBrowserPlatformLocation},{type:MessageBus},{type:Serializer}]};var WORKER_UI_LOCATION_PROVIDERS=[MessageBasedPlatformLocation,_platformBrowser.ɵBrowserPlatformLocation,{provide:_core.PLATFORM_INITIALIZER,useFactory:initUiLocation,multi:!0,deps:[_core.Injector]}],WebWorkerPlatformLocation=function(_PlatformLocation){function WebWorkerPlatformLocation(t,o,s){var _this22;return _classCallCheck(this,WebWorkerPlatformLocation),_this22=_possibleConstructorReturn(this,(WebWorkerPlatformLocation.__proto__||Object.getPrototypeOf(WebWorkerPlatformLocation)).call(this)),_this22._serializer=s,_this22._popStateListeners=[],_this22._hashChangeListeners=[],_this22._location=null,_this22._broker=t.createMessageBroker(ROUTER_CHANNEL),_this22._channelSource=o.from(ROUTER_CHANNEL),_this22._channelSource.subscribe({next:function(a){var l=null;if(a.hasOwnProperty("event")){var d=a.event.type;"popstate"===d?l=_this22._popStateListeners:"hashchange"===d&&(l=_this22._hashChangeListeners),l&&(_this22._location=_this22._serializer.deserialize(a.location,LocationType),l.forEach(function(m){return m(a.event)}))}}}),_this22}return _inherits(WebWorkerPlatformLocation,_PlatformLocation),_createClass(WebWorkerPlatformLocation,[{key:"init",value:function(){var _this23=this,t=new UiArguments("getLocation");return this._broker.runOnService(t,LocationType).then(function(o){return _this23._location=o,!0},function(o){throw new Error(o)})}},{key:"getBaseHrefFromDOM",value:function(){throw new Error("Attempt to get base href from DOM from WebWorker. You must either provide a value for the APP_BASE_HREF token through DI or use the hash location strategy.")}},{key:"onPopState",value:function(t){this._popStateListeners.push(t)}},{key:"onHashChange",value:function(t){this._hashChangeListeners.push(t)}},{key:"pushState",value:function(t,o,s){var a=[new FnArg(t,1),new FnArg(o,1),new FnArg(s,1)],l=new UiArguments("pushState",a);this._broker.runOnService(l,null)}},{key:"replaceState",value:function(t,o,s){var a=[new FnArg(t,1),new FnArg(o,1),new FnArg(s,1)],l=new UiArguments("replaceState",a);this._broker.runOnService(l,null)}},{key:"forward",value:function(){var t=new UiArguments("forward");this._broker.runOnService(t,null)}},{key:"back",value:function(){var t=new UiArguments("back");this._broker.runOnService(t,null)}},{key:"pathname",get:function(){return this._location?this._location.pathname:null},set:function(t){if(null===this._location)throw new Error("Attempt to set pathname before value is obtained from UI");this._location.pathname=t;var o=[new FnArg(t,1)],s=new UiArguments("setPathname",o);this._broker.runOnService(s,null)}},{key:"search",get:function(){return this._location?this._location.search:null}},{key:"hash",get:function(){return this._location?this._location.hash:null}}]),WebWorkerPlatformLocation}(_common.PlatformLocation);WebWorkerPlatformLocation.decorators=[{type:_core.Injectable}],WebWorkerPlatformLocation.ctorParameters=function(){return[{type:ClientMessageBrokerFactory},{type:MessageBus},{type:Serializer}]};var WORKER_APP_LOCATION_PROVIDERS=[{provide:_common.PlatformLocation,useClass:WebWorkerPlatformLocation},{provide:_core.APP_INITIALIZER,useFactory:appInitFnFactory,multi:!0,deps:[_common.PlatformLocation,_core.NgZone]}],NamedEventEmitter=function(){function NamedEventEmitter(){_classCallCheck(this,NamedEventEmitter)}return _createClass(NamedEventEmitter,[{key:"listen",value:function(t,o){this._getListeners(t).push(o)}},{key:"unlisten",value:function(t,o){var s=this._getListeners(t),a=s.indexOf(o);-1<a&&s.splice(a,1)}},{key:"dispatchEvent",value:function(t,o){for(var s=this._getListeners(t),a=0;a<s.length;a++)s[a](o)}},{key:"_getListeners",value:function(t){this._listeners||(this._listeners=new Map);var o=this._listeners.get(t);return o||(o=[],this._listeners.set(t,o)),o}}]),NamedEventEmitter}(),WebWorkerRootRenderer=function(){function WebWorkerRootRenderer(t,o,s,a){var _this24=this;_classCallCheck(this,WebWorkerRootRenderer),this._serializer=s,this.renderStore=a,this.globalEvents=new NamedEventEmitter,this._componentRenderers=new Map,this._messageBroker=t.createMessageBroker(RENDERER_CHANNEL),o.initChannel(EVENT_CHANNEL);var l=o.from(EVENT_CHANNEL);throw l.subscribe({next:function(d){return _this24._dispatchEvent(d)}}),new Error("RootRenderer is no longer supported. Please use the `RendererFactoryV2` instead!")}return _createClass(WebWorkerRootRenderer,[{key:"_dispatchEvent",value:function(t){var o=this._serializer.deserialize(t.element,2),s=t.animationPlayer;if(s){var a=t.phaseName,l=this._serializer.deserialize(s,2);o.animationPlayerEvents.dispatchEvent(l,a)}else{var _a=t.eventName,_l=t.eventTarget,d=t.event;_l?this.globalEvents.dispatchEvent(eventNameWithTarget(_l,_a),d):o.events.dispatchEvent(_a,d)}}},{key:"renderComponent",value:function(t){var o=this._componentRenderers.get(t.id);if(!o){o=new WebWorkerRenderer(this,t),this._componentRenderers.set(t.id,o);var s=this.renderStore.allocateId();this.renderStore.store(o,s),this.runOnService("renderComponent",[new FnArg(t,_core.RenderComponentType),new FnArg(o,2)])}return o}},{key:"runOnService",value:function(t,o){var s=new UiArguments(t,o);this._messageBroker.runOnService(s,null)}},{key:"allocateNode",value:function(){var t=new WebWorkerRenderNode,o=this.renderStore.allocateId();return this.renderStore.store(t,o),t}},{key:"allocateId",value:function(){return this.renderStore.allocateId()}},{key:"destroyNodes",value:function(t){for(var o=0;o<t.length;o++)this.renderStore.remove(t[o])}}]),WebWorkerRootRenderer}();WebWorkerRootRenderer.decorators=[{type:_core.Injectable}],WebWorkerRootRenderer.ctorParameters=function(){return[{type:ClientMessageBrokerFactory},{type:MessageBus},{type:Serializer},{type:RenderStore}]};var WebWorkerRenderer=function(){function WebWorkerRenderer(t,o){_classCallCheck(this,WebWorkerRenderer),this._rootRenderer=t,this._componentType=o}return _createClass(WebWorkerRenderer,[{key:"_runOnService",value:function(t,o){var s=[new FnArg(this,2)].concat(_toConsumableArray(o));this._rootRenderer.runOnService(t,s)}},{key:"selectRootElement",value:function(t){var s=this._rootRenderer.allocateNode();return this._runOnService("selectRootElement",[new FnArg(t),new FnArg(s,2)]),s}},{key:"createElement",value:function(t,o){var a=this._rootRenderer.allocateNode();return this._runOnService("createElement",[new FnArg(t,2),new FnArg(o),new FnArg(a,2)]),a}},{key:"createViewRoot",value:function(t){var o=this._componentType.encapsulation===_core.ViewEncapsulation.Native?this._rootRenderer.allocateNode():t;return this._runOnService("createViewRoot",[new FnArg(t,2),new FnArg(o,2)]),o}},{key:"createTemplateAnchor",value:function(t){var s=this._rootRenderer.allocateNode();return this._runOnService("createTemplateAnchor",[new FnArg(t,2),new FnArg(s,2)]),s}},{key:"createText",value:function(t,o){var a=this._rootRenderer.allocateNode();return this._runOnService("createText",[new FnArg(t,2),new FnArg(o),new FnArg(a,2)]),a}},{key:"projectNodes",value:function(t,o){this._runOnService("projectNodes",[new FnArg(t,2),new FnArg(o,2)])}},{key:"attachViewAfter",value:function(t,o){this._runOnService("attachViewAfter",[new FnArg(t,2),new FnArg(o,2)])}},{key:"detachView",value:function(t){this._runOnService("detachView",[new FnArg(t,2)])}},{key:"destroyView",value:function(t,o){this._runOnService("destroyView",[new FnArg(t,2),new FnArg(o,2)]),this._rootRenderer.destroyNodes(o)}},{key:"setElementProperty",value:function(t,o,s){this._runOnService("setElementProperty",[new FnArg(t,2),new FnArg(o),new FnArg(s)])}},{key:"setElementAttribute",value:function(t,o,s){this._runOnService("setElementAttribute",[new FnArg(t,2),new FnArg(o),new FnArg(s)])}},{key:"setBindingDebugInfo",value:function(t,o,s){this._runOnService("setBindingDebugInfo",[new FnArg(t,2),new FnArg(o),new FnArg(s)])}},{key:"setElementClass",value:function(t,o,s){this._runOnService("setElementClass",[new FnArg(t,2),new FnArg(o),new FnArg(s)])}},{key:"setElementStyle",value:function(t,o,s){this._runOnService("setElementStyle",[new FnArg(t,2),new FnArg(o),new FnArg(s)])}},{key:"invokeElementMethod",value:function(t,o,s){this._runOnService("invokeElementMethod",[new FnArg(t,2),new FnArg(o),new FnArg(s)])}},{key:"setText",value:function(t,o){this._runOnService("setText",[new FnArg(t,2),new FnArg(o)])}},{key:"listen",value:function(t,o,s){var _this25=this;t.events.listen(o,s);var a=this._rootRenderer.allocateId();return this._runOnService("listen",[new FnArg(t,2),new FnArg(o),new FnArg(a)]),function(){t.events.unlisten(o,s),_this25._runOnService("listenDone",[new FnArg(a)])}}},{key:"listenGlobal",value:function(t,o,s){var _this26=this;this._rootRenderer.globalEvents.listen(eventNameWithTarget(t,o),s);var a=this._rootRenderer.allocateId();return this._runOnService("listenGlobal",[new FnArg(t),new FnArg(o,null),new FnArg(a)]),function(){_this26._rootRenderer.globalEvents.unlisten(eventNameWithTarget(t,o),s),_this26._runOnService("listenDone",[new FnArg(a)])}}},{key:"animate",value:function(t,o,s,a,l,d){var _this27=this,m=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[],c=this._rootRenderer.allocateId(),_=m.map(function(h){return _this27._rootRenderer.renderStore.serialize(h)});this._runOnService("animate",[new FnArg(t,2),new FnArg(o),new FnArg(s),new FnArg(a),new FnArg(l),new FnArg(d),new FnArg(_),new FnArg(c)]);var u=new _AnimationWorkerRendererPlayer(this._rootRenderer,t);return this._rootRenderer.renderStore.store(u,c),u}}]),WebWorkerRenderer}(),WebWorkerRendererFactoryV2=function(){function WebWorkerRendererFactoryV2(t,o,s,a){var _this28=this;_classCallCheck(this,WebWorkerRendererFactoryV2),this._serializer=s,this.renderStore=a,this.globalEvents=new NamedEventEmitter,this._messageBroker=t.createMessageBroker(RENDERER_V2_CHANNEL),o.initChannel(EVENT_V2_CHANNEL);var l=o.from(EVENT_V2_CHANNEL);l.subscribe({next:function(d){return _this28._dispatchEvent(d)}})}return _createClass(WebWorkerRendererFactoryV2,[{key:"createRenderer",value:function(t,o){var s=new WebWorkerRendererV2(this),a=this.renderStore.allocateId();return this.renderStore.store(s,a),this.callUI("createRenderer",[new FnArg(t,2),new FnArg(o,0),new FnArg(s,2)]),s}},{key:"callUI",value:function(t,o){var s=new UiArguments(t,o);this._messageBroker.runOnService(s,null)}},{key:"allocateNode",value:function(){var t=new WebWorkerRenderNode,o=this.renderStore.allocateId();return this.renderStore.store(t,o),t}},{key:"freeNode",value:function(t){this.renderStore.remove(t)}},{key:"allocateId",value:function(){return this.renderStore.allocateId()}},{key:"_dispatchEvent",value:function(t){var o=this._serializer.deserialize(t.element,2),s=t.eventName,a=t.eventTarget,l=t.event;a?this.globalEvents.dispatchEvent(eventNameWithTarget(a,s),l):o.events.dispatchEvent(s,l)}}]),WebWorkerRendererFactoryV2}();WebWorkerRendererFactoryV2.decorators=[{type:_core.Injectable}],WebWorkerRendererFactoryV2.ctorParameters=function(){return[{type:ClientMessageBrokerFactory},{type:MessageBus},{type:Serializer},{type:RenderStore}]};var WebWorkerRendererV2=function(){function WebWorkerRendererV2(t){_classCallCheck(this,WebWorkerRendererV2),this._rendererFactory=t,this.asFnArg=new FnArg(this,2)}return _createClass(WebWorkerRendererV2,[{key:"destroy",value:function(){this.callUIWithRenderer("destroy")}},{key:"destroyNode",value:function(t){this.callUIWithRenderer("destroyNode",[new FnArg(t,2)]),this._rendererFactory.freeNode(t)}},{key:"createElement",value:function(t,o){var s=this._rendererFactory.allocateNode();return this.callUIWithRenderer("createElement",[new FnArg(t),new FnArg(o),new FnArg(s,2)]),s}},{key:"createComment",value:function(t){var o=this._rendererFactory.allocateNode();return this.callUIWithRenderer("createComment",[new FnArg(t),new FnArg(o,2)]),o}},{key:"createText",value:function(t){var o=this._rendererFactory.allocateNode();return this.callUIWithRenderer("createText",[new FnArg(t),new FnArg(o,2)]),o}},{key:"appendChild",value:function(t,o){this.callUIWithRenderer("appendChild",[new FnArg(t,2),new FnArg(o,2)])}},{key:"insertBefore",value:function(t,o,s){t&&this.callUIWithRenderer("insertBefore",[new FnArg(t,2),new FnArg(o,2),new FnArg(s,2)])}},{key:"removeChild",value:function(t,o){this.callUIWithRenderer("removeChild",[new FnArg(t,2),new FnArg(o,2)])}},{key:"selectRootElement",value:function(t){var o=this._rendererFactory.allocateNode();return this.callUIWithRenderer("selectRootElement",[new FnArg(t),new FnArg(o,2)]),o}},{key:"parentNode",value:function(t){var o=this._rendererFactory.allocateNode();return this.callUIWithRenderer("parentNode",[new FnArg(t,2),new FnArg(o,2)]),o}},{key:"nextSibling",value:function(t){var o=this._rendererFactory.allocateNode();return this.callUIWithRenderer("nextSibling",[new FnArg(t,2),new FnArg(o,2)]),o}},{key:"setAttribute",value:function(t,o,s,a){this.callUIWithRenderer("setAttribute",[new FnArg(t,2),new FnArg(o),new FnArg(s),new FnArg(a)])}},{key:"removeAttribute",value:function(t,o,s){this.callUIWithRenderer("removeAttribute",[new FnArg(t,2),new FnArg(o),new FnArg(s)])}},{key:"addClass",value:function(t,o){this.callUIWithRenderer("addClass",[new FnArg(t,2),new FnArg(o)])}},{key:"removeClass",value:function(t,o){this.callUIWithRenderer("removeClass",[new FnArg(t,2),new FnArg(o)])}},{key:"setStyle",value:function(t,o,s,a,l){this.callUIWithRenderer("setStyle",[new FnArg(t,2),new FnArg(o),new FnArg(s),new FnArg(a),new FnArg(l)])}},{key:"removeStyle",value:function(t,o,s){this.callUIWithRenderer("removeStyle",[new FnArg(t,2),new FnArg(o),new FnArg(s)])}},{key:"setProperty",value:function(t,o,s){this.callUIWithRenderer("setProperty",[new FnArg(t,2),new FnArg(o),new FnArg(s)])}},{key:"setValue",value:function(t,o){this.callUIWithRenderer("setValue",[new FnArg(t,2),new FnArg(o)])}},{key:"listen",value:function(t,o,s){var _this29=this,a=this._rendererFactory.allocateId(),_ref5="string"==typeof t?[null,t,t+":"+o]:[t,null,null],_ref6=_slicedToArray(_ref5,3),l=_ref6[0],d=_ref6[1],m=_ref6[2];return m?this._rendererFactory.globalEvents.listen(m,s):l.events.listen(o,s),this.callUIWithRenderer("listen",[new FnArg(l,2),new FnArg(d),new FnArg(o),new FnArg(a)]),function(){m?_this29._rendererFactory.globalEvents.unlisten(m,s):l.events.unlisten(o,s),_this29.callUIWithRenderer("unlisten",[new FnArg(a)])}}},{key:"callUIWithRenderer",value:function(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this._rendererFactory.callUI(t,[this.asFnArg].concat(_toConsumableArray(o)))}}]),WebWorkerRendererV2}(),AnimationPlayerEmitter=function(){function AnimationPlayerEmitter(){_classCallCheck(this,AnimationPlayerEmitter)}return _createClass(AnimationPlayerEmitter,[{key:"_getListeners",value:function(t,o){this._listeners||(this._listeners=new Map);var s=this._listeners.get(t);s||this._listeners.set(t,s={});var a=s[o];return a||(a=s[o]=[]),a}},{key:"listen",value:function(t,o,s){this._getListeners(t,o).push(s)}},{key:"unlisten",value:function(t){this._listeners.delete(t)}},{key:"dispatchEvent",value:function(t,o){for(var s=this._getListeners(t,o),a=0;a<s.length;a++)s[a]()}}]),AnimationPlayerEmitter}(),WebWorkerRenderNode=function WebWorkerRenderNode(){_classCallCheck(this,WebWorkerRenderNode),this.events=new NamedEventEmitter,this.animationPlayerEvents=new AnimationPlayerEmitter},_AnimationWorkerRendererPlayer=function(){function _AnimationWorkerRendererPlayer(t,o){_classCallCheck(this,_AnimationWorkerRendererPlayer),this._rootRenderer=t,this._renderElement=o,this.parentPlayer=null,this._destroyed=!1,this._started=!1}return _createClass(_AnimationWorkerRendererPlayer,[{key:"_runOnService",value:function(t,o){if(!this._destroyed){var s=[new FnArg(this,2),new FnArg(this._renderElement,2)].concat(_toConsumableArray(o));this._rootRenderer.runOnService(ANIMATION_WORKER_PLAYER_PREFIX+t,s)}}},{key:"onStart",value:function(t){this._renderElement.animationPlayerEvents.listen(this,"onStart",t),this._runOnService("onStart",[])}},{key:"onDone",value:function(t){this._renderElement.animationPlayerEvents.listen(this,"onDone",t),this._runOnService("onDone",[])}},{key:"onDestroy",value:function(t){this._renderElement.animationPlayerEvents.listen(this,"onDestroy",t),this._runOnService("onDestroy",[])}},{key:"hasStarted",value:function(){return this._started}},{key:"init",value:function(){this._runOnService("init",[])}},{key:"play",value:function(){this._started=!0,this._runOnService("play",[])}},{key:"pause",value:function(){this._runOnService("pause",[])}},{key:"restart",value:function(){this._runOnService("restart",[])}},{key:"finish",value:function(){this._runOnService("finish",[])}},{key:"destroy",value:function(){this._destroyed||(this._renderElement.animationPlayerEvents.unlisten(this),this._runOnService("destroy",[]),this._rootRenderer.renderStore.remove(this),this._destroyed=!0)}},{key:"reset",value:function(){this._runOnService("reset",[])}},{key:"setPosition",value:function(t){this._runOnService("setPosition",[new FnArg(t)])}},{key:"getPosition",value:function(){return 0}}]),_AnimationWorkerRendererPlayer}(),WorkerDomAdapter=function(_DomAdapter){function WorkerDomAdapter(){return _classCallCheck(this,WorkerDomAdapter),_possibleConstructorReturn(this,(WorkerDomAdapter.__proto__||Object.getPrototypeOf(WorkerDomAdapter)).apply(this,arguments))}return _inherits(WorkerDomAdapter,_DomAdapter),_createClass(WorkerDomAdapter,[{key:"logError",value:function(t){console.error?console.error(t):console.log(t)}},{key:"log",value:function(t){console.log(t)}},{key:"logGroup",value:function(t){console.group?(console.group(t),this.logError(t)):console.log(t)}},{key:"logGroupEnd",value:function(){console.groupEnd&&console.groupEnd()}},{key:"hasProperty",value:function(){throw"not implemented"}},{key:"setProperty",value:function(){throw"not implemented"}},{key:"getProperty",value:function(){throw"not implemented"}},{key:"invoke",value:function(){throw"not implemented"}},{key:"parse",value:function(){throw"not implemented"}},{key:"querySelector",value:function(){throw"not implemented"}},{key:"querySelectorAll",value:function(){throw"not implemented"}},{key:"on",value:function(){throw"not implemented"}},{key:"onAndCancel",value:function(){throw"not implemented"}},{key:"dispatchEvent",value:function(){throw"not implemented"}},{key:"createMouseEvent",value:function(){throw"not implemented"}},{key:"createEvent",value:function(){throw"not implemented"}},{key:"preventDefault",value:function(){throw"not implemented"}},{key:"isPrevented",value:function(){throw"not implemented"}},{key:"getInnerHTML",value:function(){throw"not implemented"}},{key:"getTemplateContent",value:function(){throw"not implemented"}},{key:"getOuterHTML",value:function(){throw"not implemented"}},{key:"nodeName",value:function(){throw"not implemented"}},{key:"nodeValue",value:function(){throw"not implemented"}},{key:"type",value:function(){throw"not implemented"}},{key:"content",value:function(){throw"not implemented"}},{key:"firstChild",value:function(){throw"not implemented"}},{key:"nextSibling",value:function(){throw"not implemented"}},{key:"parentElement",value:function(){throw"not implemented"}},{key:"childNodes",value:function(){throw"not implemented"}},{key:"childNodesAsList",value:function(){throw"not implemented"}},{key:"clearNodes",value:function(){throw"not implemented"}},{key:"appendChild",value:function(){throw"not implemented"}},{key:"removeChild",value:function(){throw"not implemented"}},{key:"replaceChild",value:function(){throw"not implemented"}},{key:"remove",value:function(){throw"not implemented"}},{key:"insertBefore",value:function(){throw"not implemented"}},{key:"insertAllBefore",value:function(){throw"not implemented"}},{key:"insertAfter",value:function(){throw"not implemented"}},{key:"setInnerHTML",value:function(){throw"not implemented"}},{key:"getText",value:function(){throw"not implemented"}},{key:"setText",value:function(){throw"not implemented"}},{key:"getValue",value:function(){throw"not implemented"}},{key:"setValue",value:function(){throw"not implemented"}},{key:"getChecked",value:function(){throw"not implemented"}},{key:"setChecked",value:function(){throw"not implemented"}},{key:"createComment",value:function(){throw"not implemented"}},{key:"createTemplate",value:function(){throw"not implemented"}},{key:"createElement",value:function(){throw"not implemented"}},{key:"createElementNS",value:function(){throw"not implemented"}},{key:"createTextNode",value:function(){throw"not implemented"}},{key:"createScriptTag",value:function(){throw"not implemented"}},{key:"createStyleElement",value:function(){throw"not implemented"}},{key:"createShadowRoot",value:function(){throw"not implemented"}},{key:"getShadowRoot",value:function(){throw"not implemented"}},{key:"getHost",value:function(){throw"not implemented"}},{key:"getDistributedNodes",value:function(){throw"not implemented"}},{key:"clone",value:function(){throw"not implemented"}},{key:"getElementsByClassName",value:function(){throw"not implemented"}},{key:"getElementsByTagName",value:function(){throw"not implemented"}},{key:"classList",value:function(){throw"not implemented"}},{key:"addClass",value:function(){throw"not implemented"}},{key:"removeClass",value:function(){throw"not implemented"}},{key:"hasClass",value:function(){throw"not implemented"}},{key:"setStyle",value:function(){throw"not implemented"}},{key:"removeStyle",value:function(){throw"not implemented"}},{key:"getStyle",value:function(){throw"not implemented"}},{key:"hasStyle",value:function(){throw"not implemented"}},{key:"tagName",value:function(){throw"not implemented"}},{key:"attributeMap",value:function(){throw"not implemented"}},{key:"hasAttribute",value:function(){throw"not implemented"}},{key:"hasAttributeNS",value:function(){throw"not implemented"}},{key:"getAttribute",value:function(){throw"not implemented"}},{key:"getAttributeNS",value:function(){throw"not implemented"}},{key:"setAttribute",value:function(){throw"not implemented"}},{key:"setAttributeNS",value:function(){throw"not implemented"}},{key:"removeAttribute",value:function(){throw"not implemented"}},{key:"removeAttributeNS",value:function(){throw"not implemented"}},{key:"templateAwareRoot",value:function(){throw"not implemented"}},{key:"createHtmlDocument",value:function(){throw"not implemented"}},{key:"getBoundingClientRect",value:function(){throw"not implemented"}},{key:"getTitle",value:function(){throw"not implemented"}},{key:"setTitle",value:function(){throw"not implemented"}},{key:"elementMatches",value:function(){throw"not implemented"}},{key:"isTemplateElement",value:function(){throw"not implemented"}},{key:"isTextNode",value:function(){throw"not implemented"}},{key:"isCommentNode",value:function(){throw"not implemented"}},{key:"isElementNode",value:function(){throw"not implemented"}},{key:"hasShadowRoot",value:function(){throw"not implemented"}},{key:"isShadowRoot",value:function(){throw"not implemented"}},{key:"importIntoDoc",value:function(){throw"not implemented"}},{key:"adoptNode",value:function(){throw"not implemented"}},{key:"getHref",value:function(){throw"not implemented"}},{key:"getEventKey",value:function(){throw"not implemented"}},{key:"resolveAndSetHref",value:function(){throw"not implemented"}},{key:"supportsDOMEvents",value:function(){throw"not implemented"}},{key:"supportsNativeShadowDOM",value:function(){throw"not implemented"}},{key:"getGlobalEventTarget",value:function(){throw"not implemented"}},{key:"getHistory",value:function(){throw"not implemented"}},{key:"getLocation",value:function(){throw"not implemented"}},{key:"getBaseHref",value:function(){throw"not implemented"}},{key:"resetBaseElement",value:function(){throw"not implemented"}},{key:"getUserAgent",value:function(){throw"not implemented"}},{key:"setData",value:function(){throw"not implemented"}},{key:"getComputedStyle",value:function(){throw"not implemented"}},{key:"getData",value:function(){throw"not implemented"}},{key:"setGlobalVar",value:function(){throw"not implemented"}},{key:"performanceNow",value:function(){throw"not implemented"}},{key:"getAnimationPrefix",value:function(){throw"not implemented"}},{key:"getTransitionEnd",value:function(){throw"not implemented"}},{key:"supportsAnimation",value:function(){throw"not implemented"}},{key:"supportsWebAnimation",value:function(){throw"not implemented"}},{key:"supportsCookies",value:function(){return!1}},{key:"getCookie",value:function(){throw"not implemented"}},{key:"setCookie",value:function(){throw"not implemented"}},{key:"attrToPropMap",get:function(){throw"not implemented"},set:function(t){throw"not implemented"}}],[{key:"makeCurrent",value:function(){(0,_platformBrowser.ɵsetRootDomAdapter)(new WorkerDomAdapter)}}]),WorkerDomAdapter}(_platformBrowser.ɵDomAdapter),platformWorkerApp=(0,_core.createPlatformFactory)(_core.platformCore,"workerApp",[{provide:_core.PLATFORM_ID,useValue:_common.ɵPLATFORM_WORKER_APP_ID}]),_postMessage={postMessage:function(_postMessage2){function postMessage(_x12,_x13){return _postMessage2.apply(this,arguments)}return postMessage.toString=function(){return _postMessage2.toString()},postMessage}(function(t,o){postMessage(t,o)})},WorkerAppModule=function WorkerAppModule(){_classCallCheck(this,WorkerAppModule)};WorkerAppModule.decorators=[{type:_core.NgModule,args:[{providers:[_platformBrowser.ɵBROWSER_SANITIZATION_PROVIDERS,Serializer,{provide:_platformBrowser.DOCUMENT,useValue:null},{provide:ClientMessageBrokerFactory,useClass:ClientMessageBrokerFactory_},{provide:ServiceMessageBrokerFactory,useClass:ServiceMessageBrokerFactory_},WebWorkerRootRenderer,{provide:_core.RootRenderer,useExisting:WebWorkerRootRenderer},WebWorkerRendererFactoryV2,{provide:_core.RendererFactoryV2,useExisting:WebWorkerRendererFactoryV2},{provide:ON_WEB_WORKER,useValue:!0},RenderStore,{provide:_core.ErrorHandler,useFactory:errorHandler,deps:[]},{provide:MessageBus,useFactory:createMessageBus,deps:[_core.NgZone]},{provide:_core.APP_INITIALIZER,useValue:setupWebWorker,multi:!0}],exports:[_common.CommonModule,_core.ApplicationModule]}]}],WorkerAppModule.ctorParameters=function(){return[]},exports.VERSION=VERSION,exports.ClientMessageBroker=ClientMessageBroker,exports.ClientMessageBrokerFactory=ClientMessageBrokerFactory,exports.FnArg=FnArg,exports.UiArguments=UiArguments,exports.MessageBus=MessageBus,exports.PRIMITIVE=PRIMITIVE,exports.ServiceMessageBroker=ServiceMessageBroker,exports.ServiceMessageBrokerFactory=ServiceMessageBrokerFactory,exports.WORKER_UI_LOCATION_PROVIDERS=WORKER_UI_LOCATION_PROVIDERS,exports.WORKER_APP_LOCATION_PROVIDERS=WORKER_APP_LOCATION_PROVIDERS,exports.WorkerAppModule=WorkerAppModule,exports.platformWorkerApp=platformWorkerApp,exports.platformWorkerUi=platformWorkerUi,exports.bootstrapWorkerUi=bootstrapWorkerUi,exports.ɵk=ON_WEB_WORKER,exports.ɵa=ClientMessageBrokerFactory_,exports.ɵh=RenderStore,exports.ɵb=Serializer,exports.ɵc=ServiceMessageBrokerFactory_,exports.ɵj=WebWorkerRendererFactoryV2,exports.ɵi=WebWorkerRootRenderer,exports.ɵe=createMessageBus,exports.ɵd=errorHandler,exports.ɵf=setupWebWorker,exports.ɵg=_WORKER_UI_PLATFORM_PROVIDERS});