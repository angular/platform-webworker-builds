!function(global,factory){if("function"==typeof define&&define.amd)define("@angular/platform-webworker",["exports","@angular/core","@angular/platform-browser","rxjs/Subject","@angular/common","rxjs/Observable"],factory);else if("undefined"!=typeof exports)factory(exports,require("@angular/core"),require("@angular/platform-browser"),require("rxjs/Subject"),require("@angular/common"),require("rxjs/Observable"));else{var mod={exports:{}};factory(mod.exports,global.ng.core,global.ng.platformBrowser,global.Rx,global.ng.common,global.Rx),global.ng=global.ng||{},global.ng.platformWebworker=mod.exports}}(this,function(exports,_core,_platformBrowser,_Subject2,_common){"use strict";function _toArray(arr){return Array.isArray(arr)?arr:Array.from(arr)}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function stringify(t){if("string"==typeof t)return t;if(null==t)return""+t;if(t.overriddenName)return""+t.overriddenName;if(t.name)return""+t.name;var r=t.toString(),o=r.indexOf("\n");return-1===o?r:r.substring(0,o)}function serializeGenericEvent(t){return serializeEvent(t,EVENT_PROPERTIES)}function serializeEventWithTarget(t){var r=serializeEvent(t,EVENT_PROPERTIES);return addTarget(t,r)}function serializeMouseEvent(t){return serializeEvent(t,MOUSE_EVENT_PROPERTIES)}function serializeKeyboardEvent(t){var r=serializeEvent(t,KEYBOARD_EVENT_PROPERTIES);return addTarget(t,r)}function serializeTransitionEvent(t){var r=serializeEvent(t,TRANSITION_EVENT_PROPERTIES);return addTarget(t,r)}function addTarget(t,r){if(NODES_WITH_VALUE.has(t.target.tagName.toLowerCase())){var o=t.target;r.target={value:o.value},o.files&&(r.target.files=o.files)}return r}function serializeEvent(t,r){for(var o={},a=0;a<r.length;a++){var s=r[a];o[s]=t[s]}return o}function initializeGenericWorkerRenderer(t){var r=t.get(MessageBus),o=t.get(_core.NgZone);r.attachToZone(o);var a=t.get(WORKER_UI_STARTABLE_MESSAGING_SERVICE);o.runGuarded(function(){a.forEach(function(s){s.start()})})}function messageBusFactory(t){return t.bus}function initWebWorkerRenderPlatform(t){return function(){_platformBrowser.ɵBrowserDomAdapter.makeCurrent(),_platformBrowser.ɵBrowserGetTestability.init();var r=void 0;try{r=t.get(WORKER_SCRIPT)}catch(a){throw new Error("You must provide your WebWorker's initialization script with the WORKER_SCRIPT token")}var o=t.get(WebWorkerInstance);spawnWebWorker(r,o),initializeGenericWorkerRenderer(t)}}function _exceptionHandler(){return new _core.ErrorHandler}function _document(){return document}function createNgZone(){return new _core.NgZone({enableLongStackTrace:(0,_core.isDevMode)()})}function spawnWebWorker(t,r){var o=new Worker(t),a=new PostMessageBusSink(o),s=new PostMessageBusSource(o),l=new PostMessageBus(a,s);r.init(o,l)}function _resolveDefaultAnimationDriver(){return(0,_platformBrowser.ɵgetDOM)().supportsWebAnimation()?new _platformBrowser.ɵWebAnimationsDriver:_platformBrowser.AnimationDriver.NOOP}function initUiLocation(t){return function(){var r=t.get(_core.NgZone);r.runGuarded(function(){return t.get(MessageBasedPlatformLocation).start()})}}function appInitFnFactory(t,r){return function(){return r.runGuarded(function(){return t.init()})}}function eventNameWithTarget(t,r){return t+":"+r}function errorHandler(){return new _core.ErrorHandler}function createMessageBus(t){var r=new PostMessageBusSink(_postMessage),o=new PostMessageBusSource,a=new PostMessageBus(r,o);return a.attachToZone(t),a}function setupWebWorker(){WorkerDomAdapter.makeCurrent()}function bootstrapWorkerUi(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],o=platformWorkerUi([{provide:WORKER_SCRIPT,useValue:t}].concat(_toConsumableArray(r)));return Promise.resolve(o)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.ɵg=exports.ɵf=exports.ɵd=exports.ɵe=exports.ɵi=exports.ɵj=exports.ɵc=exports.ɵb=exports.ɵh=exports.ɵa=exports.ɵk=exports.bootstrapWorkerUi=exports.platformWorkerUi=exports.platformWorkerApp=exports.WorkerAppModule=exports.WORKER_APP_LOCATION_PROVIDERS=exports.WORKER_UI_LOCATION_PROVIDERS=exports.ServiceMessageBrokerFactory=exports.ServiceMessageBroker=exports.PRIMITIVE=exports.MessageBus=exports.UiArguments=exports.FnArg=exports.ClientMessageBrokerFactory=exports.ClientMessageBroker=exports.VERSION=void 0;var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{!_n&&_i.return&&_i.return()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr))return arr;if(Symbol.iterator in Object(arr))return sliceIterator(arr,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_get=function get(object,property,receiver){null===object&&(object=Function.prototype);var desc=Object.getOwnPropertyDescriptor(object,property);if(void 0===desc){var parent=Object.getPrototypeOf(object);return null===parent?void 0:get(parent,property,receiver)}if("value"in desc)return desc.value;var getter=desc.get;if(void 0!==getter)return getter.call(receiver)},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),ON_WEB_WORKER=new _core.InjectionToken("WebWorker.onWebWorker"),MessageBus=function(){function MessageBus(){_classCallCheck(this,MessageBus)}return _createClass(MessageBus,[{key:"initChannel",value:function(){}},{key:"attachToZone",value:function(){}},{key:"from",value:function(){}},{key:"to",value:function(){}}]),MessageBus}(),RenderStore=function(){function RenderStore(){_classCallCheck(this,RenderStore),this._nextIndex=0,this._lookupById=new Map,this._lookupByObject=new Map}return _createClass(RenderStore,[{key:"allocateId",value:function(){return this._nextIndex++}},{key:"store",value:function(t,r){null==r||(this._lookupById.set(r,t),this._lookupByObject.set(t,r))}},{key:"remove",value:function(t){var r=this._lookupByObject.get(t);null!=r&&(this._lookupByObject.delete(t),this._lookupById.delete(r))}},{key:"deserialize",value:function(t){return this._lookupById.has(t)?this._lookupById.get(t):null}},{key:"serialize",value:function(t){return null==t?null:this._lookupByObject.get(t)}}]),RenderStore}();RenderStore.decorators=[{type:_core.Injectable}],RenderStore.ctorParameters=function(){return[]};var PRIMITIVE=1,LocationType=function LocationType(t,r,o,a,s,l,d,m,c){_classCallCheck(this,LocationType),this.href=t,this.protocol=r,this.host=o,this.hostname=a,this.port=s,this.pathname=l,this.search=d,this.hash=m,this.origin=c},Serializer=function(){function Serializer(t){_classCallCheck(this,Serializer),this._renderStore=t}return _createClass(Serializer,[{key:"serialize",value:function(t){var _this=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(null==t||1===r)return t;if(Array.isArray(t))return t.map(function(o){return _this.serialize(o,r)});if(2===r)return this._renderStore.serialize(t);if(r===_core.RenderComponentType)return this._serializeRenderComponentType(t);if(0===r)return this._serializeRendererTypeV2(t);if(r===LocationType)return this._serializeLocation(t);throw new Error("No serializer for type "+stringify(r))}},{key:"deserialize",value:function(t){var _this2=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments[2];if(null==t||1===r)return t;if(Array.isArray(t))return t.map(function(a){return _this2.deserialize(a,r,o)});if(2===r)return this._renderStore.deserialize(t);if(r===_core.RenderComponentType)return this._deserializeRenderComponentType(t);if(0===r)return this._deserializeRendererTypeV2(t);if(r===LocationType)return this._deserializeLocation(t);throw new Error("No deserializer for type "+stringify(r))}},{key:"_serializeLocation",value:function(t){return{href:t.href,protocol:t.protocol,host:t.host,hostname:t.hostname,port:t.port,pathname:t.pathname,search:t.search,hash:t.hash,origin:t.origin}}},{key:"_deserializeLocation",value:function(t){return new LocationType(t.href,t.protocol,t.host,t.hostname,t.port,t.pathname,t.search,t.hash,t.origin)}},{key:"_serializeRenderComponentType",value:function(t){return{id:t.id,templateUrl:t.templateUrl,slotCount:t.slotCount,encapsulation:this.serialize(t.encapsulation),styles:this.serialize(t.styles)}}},{key:"_deserializeRenderComponentType",value:function(t){return new _core.RenderComponentType(t.id,t.templateUrl,t.slotCount,this.deserialize(t.encapsulation),this.deserialize(t.styles),{})}},{key:"_serializeRendererTypeV2",value:function(t){return{id:t.id,encapsulation:this.serialize(t.encapsulation),styles:this.serialize(t.styles),data:this.serialize(t.data)}}},{key:"_deserializeRendererTypeV2",value:function(t){return{id:t.id,encapsulation:t.encapsulation,styles:this.deserialize(t.styles),data:this.deserialize(t.data)}}}]),Serializer}();Serializer.decorators=[{type:_core.Injectable}],Serializer.ctorParameters=function(){return[{type:RenderStore}]};var ANIMATION_WORKER_PLAYER_PREFIX="AnimationPlayer.",ClientMessageBrokerFactory=function(){function ClientMessageBrokerFactory(){_classCallCheck(this,ClientMessageBrokerFactory)}return _createClass(ClientMessageBrokerFactory,[{key:"createMessageBroker",value:function(){}}]),ClientMessageBrokerFactory}(),ClientMessageBrokerFactory_=function(_ClientMessageBrokerF){function ClientMessageBrokerFactory_(t,r){var _this3;return _classCallCheck(this,ClientMessageBrokerFactory_),_this3=_possibleConstructorReturn(this,(ClientMessageBrokerFactory_.__proto__||Object.getPrototypeOf(ClientMessageBrokerFactory_)).call(this)),_this3._messageBus=t,_this3._serializer=r,_this3}return _inherits(ClientMessageBrokerFactory_,_ClientMessageBrokerF),_createClass(ClientMessageBrokerFactory_,[{key:"createMessageBroker",value:function(t){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._messageBus.initChannel(t,r),new ClientMessageBroker_(this._messageBus,this._serializer,t)}}]),ClientMessageBrokerFactory_}(ClientMessageBrokerFactory);ClientMessageBrokerFactory_.decorators=[{type:_core.Injectable}],ClientMessageBrokerFactory_.ctorParameters=function(){return[{type:MessageBus},{type:Serializer}]};var ClientMessageBroker=function(){function ClientMessageBroker(){_classCallCheck(this,ClientMessageBroker)}return _createClass(ClientMessageBroker,[{key:"runOnService",value:function(){}}]),ClientMessageBroker}(),ClientMessageBroker_=function(_ClientMessageBroker){function ClientMessageBroker_(t,r,o){var _this4;_classCallCheck(this,ClientMessageBroker_),_this4=_possibleConstructorReturn(this,(ClientMessageBroker_.__proto__||Object.getPrototypeOf(ClientMessageBroker_)).call(this)),_this4.channel=o,_this4._pending=new Map,_this4._sink=t.to(o),_this4._serializer=r;var a=t.from(o);return a.subscribe({next:function(s){return _this4._handleMessage(s)}}),_this4}return _inherits(ClientMessageBroker_,_ClientMessageBroker),_createClass(ClientMessageBroker_,[{key:"_generateMessageId",value:function(t){for(var r=stringify((new Date).getTime()),o=0,a=t+r+stringify(o);this._pending.has(a);)a=""+t+r+o,o++;return a}},{key:"runOnService",value:function(t,r){var _this5=this,o=[];t.args&&t.args.forEach(function(d){null==d.type?o.push(d.value):o.push(_this5._serializer.serialize(d.value,d.type))});var a=void 0,s=null;if(null!=r){var d=void 0;a=new Promise(function(m,c){d={resolve:m,reject:c}}),s=this._generateMessageId(t.method),this._pending.set(s,d),a.catch(function(m){console&&console.error&&console.error(m),d.reject(m)}),a=a.then(function(m){return _this5._serializer?_this5._serializer.deserialize(m,r):m})}else a=null;var l={method:t.method,args:o};return null!=s&&(l.id=s),this._sink.emit(l),a}},{key:"_handleMessage",value:function(t){if("result"===t.type||"error"===t.type){var r=t.id;this._pending.has(r)&&("result"===t.type?this._pending.get(r).resolve(t.value):this._pending.get(r).reject(t.value),this._pending.delete(r))}}}]),ClientMessageBroker_}(ClientMessageBroker),FnArg=function FnArg(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;_classCallCheck(this,FnArg),this.value=t,this.type=r},UiArguments=function UiArguments(t,r){_classCallCheck(this,UiArguments),this.method=t,this.args=r},EventEmitter=function(_Subject){function EventEmitter(){var _this6,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return _classCallCheck(this,EventEmitter),_this6=_possibleConstructorReturn(this,(EventEmitter.__proto__||Object.getPrototypeOf(EventEmitter)).call(this)),_this6.__isAsync=t,_this6}return _inherits(EventEmitter,_Subject),_createClass(EventEmitter,[{key:"emit",value:function(t){_get(EventEmitter.prototype.__proto__||Object.getPrototypeOf(EventEmitter.prototype),"next",this).call(this,t)}},{key:"subscribe",value:function(t,r,o){var a=void 0,s=function(){return null},l=function(){return null};return t&&"object"==("undefined"==typeof t?"undefined":_typeof(t))?(a=this.__isAsync?function(d){setTimeout(function(){return t.next(d)})}:function(d){t.next(d)},t.error&&(s=this.__isAsync?function(d){setTimeout(function(){return t.error(d)})}:function(d){t.error(d)}),t.complete&&(l=this.__isAsync?function(){setTimeout(function(){return t.complete()})}:function(){t.complete()})):(a=this.__isAsync?function(d){setTimeout(function(){return t(d)})}:function(d){t(d)},r&&(s=this.__isAsync?function(d){setTimeout(function(){return r(d)})}:function(d){r(d)}),o&&(l=this.__isAsync?function(){setTimeout(function(){return o()})}:function(){o()})),_get(EventEmitter.prototype.__proto__||Object.getPrototypeOf(EventEmitter.prototype),"subscribe",this).call(this,a,s,l)}}]),EventEmitter}(_Subject2.Subject),PostMessageBusSink=function(){function PostMessageBusSink(t){_classCallCheck(this,PostMessageBusSink),this._postMessageTarget=t,this._channels={},this._messageBuffer=[]}return _createClass(PostMessageBusSink,[{key:"attachToZone",value:function(t){var _this7=this;this._zone=t,this._zone.runOutsideAngular(function(){_this7._zone.onStable.subscribe({next:function(){_this7._handleOnEventDone()}})})}},{key:"initChannel",value:function(t){var _this8=this,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this._channels.hasOwnProperty(t))throw new Error(t+" has already been initialized");var o=new EventEmitter((!1)),a=new _Channel(o,r);this._channels[t]=a,o.subscribe(function(s){var l={channel:t,message:s};r?_this8._messageBuffer.push(l):_this8._sendMessages([l])})}},{key:"to",value:function(t){if(this._channels.hasOwnProperty(t))return this._channels[t].emitter;throw new Error(t+" is not set up. Did you forget to call initChannel?")}},{key:"_handleOnEventDone",value:function(){0<this._messageBuffer.length&&(this._sendMessages(this._messageBuffer),this._messageBuffer=[])}},{key:"_sendMessages",value:function(t){this._postMessageTarget.postMessage(t)}}]),PostMessageBusSink}(),PostMessageBusSource=function(){function PostMessageBusSource(t){var _this9=this;if(_classCallCheck(this,PostMessageBusSource),this._channels={},t)t.addEventListener("message",function(r){return _this9._handleMessages(r)});else{var r=self;r.addEventListener("message",function(o){return _this9._handleMessages(o)})}}return _createClass(PostMessageBusSource,[{key:"attachToZone",value:function(t){this._zone=t}},{key:"initChannel",value:function(t){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this._channels.hasOwnProperty(t))throw new Error(t+" has already been initialized");var o=new EventEmitter((!1)),a=new _Channel(o,r);this._channels[t]=a}},{key:"from",value:function(t){if(this._channels.hasOwnProperty(t))return this._channels[t].emitter;throw new Error(t+" is not set up. Did you forget to call initChannel?")}},{key:"_handleMessages",value:function(t){for(var r=t.data,o=0;o<r.length;o++)this._handleMessage(r[o])}},{key:"_handleMessage",value:function(t){var r=t.channel;if(this._channels.hasOwnProperty(r)){var o=this._channels[r];o.runInZone?this._zone.run(function(){o.emitter.emit(t.message)}):o.emitter.emit(t.message)}}}]),PostMessageBusSource}(),PostMessageBus=function(){function PostMessageBus(t,r){_classCallCheck(this,PostMessageBus),this.sink=t,this.source=r}return _createClass(PostMessageBus,[{key:"attachToZone",value:function(t){this.source.attachToZone(t),this.sink.attachToZone(t)}},{key:"initChannel",value:function(t){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.source.initChannel(t,r),this.sink.initChannel(t,r)}},{key:"from",value:function(t){return this.source.from(t)}},{key:"to",value:function(t){return this.sink.to(t)}}]),PostMessageBus}();PostMessageBus.decorators=[{type:_core.Injectable}],PostMessageBus.ctorParameters=function(){return[{type:PostMessageBusSink},{type:PostMessageBusSource}]};var _Channel=function _Channel(t,r){_classCallCheck(this,_Channel),this.emitter=t,this.runInZone=r},ServiceMessageBrokerFactory=function(){function ServiceMessageBrokerFactory(){_classCallCheck(this,ServiceMessageBrokerFactory)}return _createClass(ServiceMessageBrokerFactory,[{key:"createMessageBroker",value:function(){}}]),ServiceMessageBrokerFactory}(),ServiceMessageBrokerFactory_=function(_ServiceMessageBroker){function ServiceMessageBrokerFactory_(t,r){var _this10;return _classCallCheck(this,ServiceMessageBrokerFactory_),_this10=_possibleConstructorReturn(this,(ServiceMessageBrokerFactory_.__proto__||Object.getPrototypeOf(ServiceMessageBrokerFactory_)).call(this)),_this10._messageBus=t,_this10._serializer=r,_this10}return _inherits(ServiceMessageBrokerFactory_,_ServiceMessageBroker),_createClass(ServiceMessageBrokerFactory_,[{key:"createMessageBroker",value:function(t){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._messageBus.initChannel(t,r),new ServiceMessageBroker_(this._messageBus,this._serializer,t)}}]),ServiceMessageBrokerFactory_}(ServiceMessageBrokerFactory);ServiceMessageBrokerFactory_.decorators=[{type:_core.Injectable}],ServiceMessageBrokerFactory_.ctorParameters=function(){return[{type:MessageBus},{type:Serializer}]};var ServiceMessageBroker=function(){function ServiceMessageBroker(){_classCallCheck(this,ServiceMessageBroker)}return _createClass(ServiceMessageBroker,[{key:"registerMethod",value:function(){}}]),ServiceMessageBroker}(),ServiceMessageBroker_=function(_ServiceMessageBroker2){function ServiceMessageBroker_(t,r,o){var _this11;_classCallCheck(this,ServiceMessageBroker_),_this11=_possibleConstructorReturn(this,(ServiceMessageBroker_.__proto__||Object.getPrototypeOf(ServiceMessageBroker_)).call(this)),_this11._serializer=r,_this11.channel=o,_this11._methods=new Map,_this11._sink=t.to(o);var a=t.from(o);return a.subscribe({next:function(s){return _this11._handleMessage(s)}}),_this11}return _inherits(ServiceMessageBroker_,_ServiceMessageBroker2),_createClass(ServiceMessageBroker_,[{key:"registerMethod",value:function(t,r,o,a){var _this12=this;this._methods.set(t,function(s){for(var l=s.args,d=r?r.length:0,m=Array(d),_=0;_<d;_++){var u=l[_];m[_]=_this12._serializer.deserialize(u,r[_])}var c=o.apply(void 0,_toConsumableArray(m));a&&c&&_this12._wrapWebWorkerPromise(s.id,c,a)})}},{key:"_handleMessage",value:function(t){this._methods.has(t.method)&&this._methods.get(t.method)(t)}},{key:"_wrapWebWorkerPromise",value:function(t,r,o){var _this13=this;r.then(function(a){_this13._sink.emit({type:"result",value:_this13._serializer.serialize(a,o),id:t})})}}]),ServiceMessageBroker_}(ServiceMessageBroker),RENDERER_CHANNEL="ng-Renderer",EVENT_CHANNEL="ng-Events",RENDERER_V2_CHANNEL="v2.ng-Renderer",EVENT_V2_CHANNEL="v2.ng-Events",ROUTER_CHANNEL="ng-Router",MOUSE_EVENT_PROPERTIES=["altKey","button","clientX","clientY","metaKey","movementX","movementY","offsetX","offsetY","region","screenX","screenY","shiftKey"],KEYBOARD_EVENT_PROPERTIES=["altkey","charCode","code","ctrlKey","isComposing","key","keyCode","location","metaKey","repeat","shiftKey","which"],TRANSITION_EVENT_PROPERTIES=["propertyName","elapsedTime","pseudoElement"],EVENT_PROPERTIES=["type","bubbles","cancelable"],NODES_WITH_VALUE=new Set(["input","select","option","button","li","meter","progress","param","textarea"]),EventDispatcher=function(){function EventDispatcher(t,r){_classCallCheck(this,EventDispatcher),this._sink=t,this._serializer=r}return _createClass(EventDispatcher,[{key:"dispatchAnimationEvent",value:function(t,r,o){return this._sink.emit({element:this._serializer.serialize(o,2),animationPlayer:this._serializer.serialize(t,2),phaseName:r}),!0}},{key:"dispatchRenderEvent",value:function(t,r,o,a){var s=void 0;switch(a.type){case"click":case"mouseup":case"mousedown":case"dblclick":case"contextmenu":case"mouseenter":case"mouseleave":case"mousemove":case"mouseout":case"mouseover":case"show":s=serializeMouseEvent(a);break;case"keydown":case"keypress":case"keyup":s=serializeKeyboardEvent(a);break;case"input":case"change":case"blur":s=serializeEventWithTarget(a);break;case"abort":case"afterprint":case"beforeprint":case"cached":case"canplay":case"canplaythrough":case"chargingchange":case"chargingtimechange":case"close":case"dischargingtimechange":case"DOMContentLoaded":case"downloading":case"durationchange":case"emptied":case"ended":case"error":case"fullscreenchange":case"fullscreenerror":case"invalid":case"languagechange":case"levelfchange":case"loadeddata":case"loadedmetadata":case"obsolete":case"offline":case"online":case"open":case"orientatoinchange":case"pause":case"pointerlockchange":case"pointerlockerror":case"play":case"playing":case"ratechange":case"readystatechange":case"reset":case"scroll":case"seeked":case"seeking":case"stalled":case"submit":case"success":case"suspend":case"timeupdate":case"updateready":case"visibilitychange":case"volumechange":case"waiting":s=serializeGenericEvent(a);break;case"transitionend":s=serializeTransitionEvent(a);break;default:throw new Error(o+" not supported on WebWorkers")}return this._sink.emit({element:this._serializer.serialize(t,2),eventName:o,eventTarget:r,event:s}),!1}}]),EventDispatcher}(),MessageBasedRenderer=function(){function MessageBasedRenderer(t,r,o,a,s){_classCallCheck(this,MessageBasedRenderer),this._brokerFactory=t,this._bus=r,this._serializer=o,this._renderStore=a,this._rootRenderer=s}return _createClass(MessageBasedRenderer,[{key:"start",value:function(){var _this14=this,t=this._brokerFactory.createMessageBroker(RENDERER_CHANNEL);this._bus.initChannel(EVENT_CHANNEL),this._eventDispatcher=new EventDispatcher(this._bus.to(EVENT_CHANNEL),this._serializer);var r=_core.RenderComponentType,o=2,a=1,s=[["renderComponent",this._renderComponent,r,a],["selectRootElement",this._selectRootElement,o,a,a],["createElement",this._createElement,o,o,a,a],["createViewRoot",this._createViewRoot,o,o,a],["createTemplateAnchor",this._createTemplateAnchor,o,o,a],["createText",this._createText,o,o,a,a],["projectNodes",this._projectNodes,o,o,o],["attachViewAfter",this._attachViewAfter,o,o,o],["detachView",this._detachView,o,o],["destroyView",this._destroyView,o,o,o],["setElementProperty",this._setElementProperty,o,o,a,a],["setElementAttribute",this._setElementAttribute,o,o,a,a],["setBindingDebugInfo",this._setBindingDebugInfo,o,o,a,a],["setElementClass",this._setElementClass,o,o,a,a],["setElementStyle",this._setElementStyle,o,o,a,a],["invokeElementMethod",this._invokeElementMethod,o,o,a,a],["setText",this._setText,o,o,a],["listen",this._listen,o,o,a,a],["listenGlobal",this._listenGlobal,o,a,a,a],["listenDone",this._listenDone,o,o],["animate",this._animate,o,o,a,a,a,a,a,a,a]];s.forEach(function(_ref){var _ref2=_toArray(_ref),l=_ref2[0],d=_ref2[1],m=_ref2.slice(2);t.registerMethod(l,m,d.bind(_this14))}),this._bindAnimationPlayerMethods(t)}},{key:"_bindAnimationPlayerMethods",value:function(t){var _this15=this,r=1,o=2;t.registerMethod(ANIMATION_WORKER_PLAYER_PREFIX+"play",[o,o],function(a){return a.play()}),t.registerMethod(ANIMATION_WORKER_PLAYER_PREFIX+"pause",[o,o],function(a){return a.pause()}),t.registerMethod(ANIMATION_WORKER_PLAYER_PREFIX+"init",[o,o],function(a){return a.init()}),t.registerMethod(ANIMATION_WORKER_PLAYER_PREFIX+"restart",[o,o],function(a){return a.restart()}),t.registerMethod(ANIMATION_WORKER_PLAYER_PREFIX+"destroy",[o,o],function(a){a.destroy(),_this15._renderStore.remove(a)}),t.registerMethod(ANIMATION_WORKER_PLAYER_PREFIX+"finish",[o,o],function(a){return a.finish()}),t.registerMethod(ANIMATION_WORKER_PLAYER_PREFIX+"getPosition",[o,o],function(a){return a.getPosition()}),t.registerMethod(ANIMATION_WORKER_PLAYER_PREFIX+"onStart",[o,o,r],function(a,s){return _this15._listenOnAnimationPlayer(a,s,"onStart")}),t.registerMethod(ANIMATION_WORKER_PLAYER_PREFIX+"onDone",[o,o,r],function(a,s){return _this15._listenOnAnimationPlayer(a,s,"onDone")}),t.registerMethod(ANIMATION_WORKER_PLAYER_PREFIX+"setPosition",[o,o,r],function(a,s,l){return a.setPosition(l)})}},{key:"_renderComponent",value:function(t,r){var o=this._rootRenderer.renderComponent(t);this._renderStore.store(o,r)}},{key:"_selectRootElement",value:function(t,r,o){this._renderStore.store(t.selectRootElement(r,null),o)}},{key:"_createElement",value:function(t,r,o,a){this._renderStore.store(t.createElement(r,o,null),a)}},{key:"_createViewRoot",value:function(t,r,o){var a=t.createViewRoot(r);this._renderStore.serialize(r)!==o&&this._renderStore.store(a,o)}},{key:"_createTemplateAnchor",value:function(t,r,o){this._renderStore.store(t.createTemplateAnchor(r,null),o)}},{key:"_createText",value:function(t,r,o,a){this._renderStore.store(t.createText(r,o,null),a)}},{key:"_projectNodes",value:function(t,r,o){t.projectNodes(r,o)}},{key:"_attachViewAfter",value:function(t,r,o){t.attachViewAfter(r,o)}},{key:"_detachView",value:function(t,r){t.detachView(r)}},{key:"_destroyView",value:function(t,r,o){t.destroyView(r,o);for(var a=0;a<o.length;a++)this._renderStore.remove(o[a])}},{key:"_setElementProperty",value:function(t,r,o,a){t.setElementProperty(r,o,a)}},{key:"_setElementAttribute",value:function(t,r,o,a){t.setElementAttribute(r,o,a)}},{key:"_setBindingDebugInfo",value:function(t,r,o,a){t.setBindingDebugInfo(r,o,a)}},{key:"_setElementClass",value:function(t,r,o,a){t.setElementClass(r,o,a)}},{key:"_setElementStyle",value:function(t,r,o,a){t.setElementStyle(r,o,a)}},{key:"_invokeElementMethod",value:function(t,r,o,a){t.invokeElementMethod(r,o,a)}},{key:"_setText",value:function(t,r,o){t.setText(r,o)}},{key:"_listen",value:function(t,r,o,a){var _this16=this,s=t.listen(r,o,function(l){return _this16._eventDispatcher.dispatchRenderEvent(r,null,o,l)});this._renderStore.store(s,a)}},{key:"_listenGlobal",value:function(t,r,o,a){var _this17=this,s=t.listenGlobal(r,o,function(l){return _this17._eventDispatcher.dispatchRenderEvent(null,r,o,l)});this._renderStore.store(s,a)}},{key:"_listenDone",value:function(t,r){r()}},{key:"_animate",value:function(t,r,o,a,s,l,d,m,c){var _this18=this,_=void 0;m&&m.length&&(_=m.map(function(h){return _this18._renderStore.deserialize(h)}));var u=t.animate(r,o,a,s,l,d,_);this._renderStore.store(u,c)}},{key:"_listenOnAnimationPlayer",value:function(t,r,o){var _this19=this,a=function(){_this19._eventDispatcher.dispatchAnimationEvent(t,o,r)};"onDone"==o?t.onDone(function(){return a()}):t.onStart(function(){return a()})}}]),MessageBasedRenderer}();MessageBasedRenderer.decorators=[{type:_core.Injectable}],MessageBasedRenderer.ctorParameters=function(){return[{type:ServiceMessageBrokerFactory},{type:MessageBus},{type:Serializer},{type:RenderStore},{type:_core.RootRenderer}]};var WebWorkerInstance=function(){function WebWorkerInstance(){_classCallCheck(this,WebWorkerInstance)}return _createClass(WebWorkerInstance,[{key:"init",value:function(t,r){this.worker=t,this.bus=r}}]),WebWorkerInstance}();WebWorkerInstance.decorators=[{type:_core.Injectable}],WebWorkerInstance.ctorParameters=function(){return[]};var WORKER_SCRIPT=new _core.InjectionToken("WebWorkerScript"),WORKER_UI_STARTABLE_MESSAGING_SERVICE=new _core.InjectionToken("WorkerRenderStartableMsgService"),_WORKER_UI_PLATFORM_PROVIDERS=[{provide:_core.NgZone,useFactory:createNgZone,deps:[]},MessageBasedRenderer,{provide:WORKER_UI_STARTABLE_MESSAGING_SERVICE,useExisting:MessageBasedRenderer,multi:!0},_platformBrowser.ɵBROWSER_SANITIZATION_PROVIDERS,{provide:_core.ErrorHandler,useFactory:_exceptionHandler,deps:[]},{provide:_platformBrowser.DOCUMENT,useFactory:_document,deps:[]},{provide:_platformBrowser.EVENT_MANAGER_PLUGINS,useClass:_platformBrowser.ɵDomEventsPlugin,multi:!0},{provide:_platformBrowser.EVENT_MANAGER_PLUGINS,useClass:_platformBrowser.ɵKeyEventsPlugin,multi:!0},{provide:_platformBrowser.EVENT_MANAGER_PLUGINS,useClass:_platformBrowser.ɵHammerGesturesPlugin,multi:!0},{provide:_platformBrowser.HAMMER_GESTURE_CONFIG,useClass:_platformBrowser.HammerGestureConfig},_core.ɵAPP_ID_RANDOM_PROVIDER,{provide:_platformBrowser.ɵDomRootRenderer,useClass:_platformBrowser.ɵDomRootRenderer_},{provide:_core.RootRenderer,useExisting:_platformBrowser.ɵDomRootRenderer},_platformBrowser.ɵDomRendererFactoryV2,{provide:_core.RendererFactoryV2,useExisting:_platformBrowser.ɵDomRendererFactoryV2},{provide:_platformBrowser.ɵSharedStylesHost,useExisting:_platformBrowser.ɵDomSharedStylesHost},{provide:ServiceMessageBrokerFactory,useClass:ServiceMessageBrokerFactory_},{provide:ClientMessageBrokerFactory,useClass:ClientMessageBrokerFactory_},{provide:_platformBrowser.AnimationDriver,useFactory:_resolveDefaultAnimationDriver,deps:[]},Serializer,{provide:ON_WEB_WORKER,useValue:!1},RenderStore,_platformBrowser.ɵDomSharedStylesHost,_core.Testability,_platformBrowser.EventManager,WebWorkerInstance,{provide:_core.PLATFORM_INITIALIZER,useFactory:initWebWorkerRenderPlatform,multi:!0,deps:[_core.Injector]},{provide:MessageBus,useFactory:messageBusFactory,deps:[WebWorkerInstance]}],platformWorkerUi=(0,_core.createPlatformFactory)(_core.platformCore,"workerUi",_WORKER_UI_PLATFORM_PROVIDERS),VERSION=new _core.Version("0.0.0-PLACEHOLDER"),MessageBasedPlatformLocation=function(){function MessageBasedPlatformLocation(t,r,o,a){_classCallCheck(this,MessageBasedPlatformLocation),this._brokerFactory=t,this._platformLocation=r,this._serializer=a,this._platformLocation.onPopState(this._sendUrlChangeEvent.bind(this)),this._platformLocation.onHashChange(this._sendUrlChangeEvent.bind(this)),this._broker=this._brokerFactory.createMessageBroker(ROUTER_CHANNEL),this._channelSink=o.to(ROUTER_CHANNEL)}return _createClass(MessageBasedPlatformLocation,[{key:"start",value:function(){var t=1;this._broker.registerMethod("getLocation",null,this._getLocation.bind(this),LocationType),this._broker.registerMethod("setPathname",[t],this._setPathname.bind(this)),
this._broker.registerMethod("pushState",[t,t,t],this._platformLocation.pushState.bind(this._platformLocation)),this._broker.registerMethod("replaceState",[t,t,t],this._platformLocation.replaceState.bind(this._platformLocation)),this._broker.registerMethod("forward",null,this._platformLocation.forward.bind(this._platformLocation)),this._broker.registerMethod("back",null,this._platformLocation.back.bind(this._platformLocation))}},{key:"_getLocation",value:function(){return Promise.resolve(this._platformLocation.location)}},{key:"_sendUrlChangeEvent",value:function(t){this._channelSink.emit({event:{type:t.type},location:this._serializer.serialize(this._platformLocation.location,LocationType)})}},{key:"_setPathname",value:function(t){this._platformLocation.pathname=t}}]),MessageBasedPlatformLocation}();MessageBasedPlatformLocation.decorators=[{type:_core.Injectable}],MessageBasedPlatformLocation.ctorParameters=function(){return[{type:ServiceMessageBrokerFactory},{type:_platformBrowser.ɵBrowserPlatformLocation},{type:MessageBus},{type:Serializer}]};var WORKER_UI_LOCATION_PROVIDERS=[MessageBasedPlatformLocation,_platformBrowser.ɵBrowserPlatformLocation,{provide:_core.PLATFORM_INITIALIZER,useFactory:initUiLocation,multi:!0,deps:[_core.Injector]}],WebWorkerPlatformLocation=function(_PlatformLocation){function WebWorkerPlatformLocation(t,r,o){var _this20;return _classCallCheck(this,WebWorkerPlatformLocation),_this20=_possibleConstructorReturn(this,(WebWorkerPlatformLocation.__proto__||Object.getPrototypeOf(WebWorkerPlatformLocation)).call(this)),_this20._serializer=o,_this20._popStateListeners=[],_this20._hashChangeListeners=[],_this20._location=null,_this20._broker=t.createMessageBroker(ROUTER_CHANNEL),_this20._channelSource=r.from(ROUTER_CHANNEL),_this20._channelSource.subscribe({next:function(a){var s=null;if(a.hasOwnProperty("event")){var l=a.event.type;"popstate"===l?s=_this20._popStateListeners:"hashchange"===l&&(s=_this20._hashChangeListeners),s&&(_this20._location=_this20._serializer.deserialize(a.location,LocationType),s.forEach(function(d){return d(a.event)}))}}}),_this20}return _inherits(WebWorkerPlatformLocation,_PlatformLocation),_createClass(WebWorkerPlatformLocation,[{key:"init",value:function(){var _this21=this,t=new UiArguments("getLocation");return this._broker.runOnService(t,LocationType).then(function(r){return _this21._location=r,!0},function(r){throw new Error(r)})}},{key:"getBaseHrefFromDOM",value:function(){throw new Error("Attempt to get base href from DOM from WebWorker. You must either provide a value for the APP_BASE_HREF token through DI or use the hash location strategy.")}},{key:"onPopState",value:function(t){this._popStateListeners.push(t)}},{key:"onHashChange",value:function(t){this._hashChangeListeners.push(t)}},{key:"pushState",value:function(t,r,o){var a=[new FnArg(t,1),new FnArg(r,1),new FnArg(o,1)],s=new UiArguments("pushState",a);this._broker.runOnService(s,null)}},{key:"replaceState",value:function(t,r,o){var a=[new FnArg(t,1),new FnArg(r,1),new FnArg(o,1)],s=new UiArguments("replaceState",a);this._broker.runOnService(s,null)}},{key:"forward",value:function(){var t=new UiArguments("forward");this._broker.runOnService(t,null)}},{key:"back",value:function(){var t=new UiArguments("back");this._broker.runOnService(t,null)}},{key:"pathname",get:function(){return this._location?this._location.pathname:null},set:function(t){if(null===this._location)throw new Error("Attempt to set pathname before value is obtained from UI");this._location.pathname=t;var r=[new FnArg(t,1)],o=new UiArguments("setPathname",r);this._broker.runOnService(o,null)}},{key:"search",get:function(){return this._location?this._location.search:null}},{key:"hash",get:function(){return this._location?this._location.hash:null}}]),WebWorkerPlatformLocation}(_common.PlatformLocation);WebWorkerPlatformLocation.decorators=[{type:_core.Injectable}],WebWorkerPlatformLocation.ctorParameters=function(){return[{type:ClientMessageBrokerFactory},{type:MessageBus},{type:Serializer}]};var WORKER_APP_LOCATION_PROVIDERS=[{provide:_common.PlatformLocation,useClass:WebWorkerPlatformLocation},{provide:_core.APP_INITIALIZER,useFactory:appInitFnFactory,multi:!0,deps:[_common.PlatformLocation,_core.NgZone]}],NamedEventEmitter=function(){function NamedEventEmitter(){_classCallCheck(this,NamedEventEmitter)}return _createClass(NamedEventEmitter,[{key:"listen",value:function(t,r){this._getListeners(t).push(r)}},{key:"unlisten",value:function(t,r){var o=this._getListeners(t),a=o.indexOf(r);-1<a&&o.splice(a,1)}},{key:"dispatchEvent",value:function(t,r){for(var o=this._getListeners(t),a=0;a<o.length;a++)o[a](r)}},{key:"_getListeners",value:function(t){this._listeners||(this._listeners=new Map);var r=this._listeners.get(t);return r||(r=[],this._listeners.set(t,r)),r}}]),NamedEventEmitter}(),WebWorkerRootRenderer=function(){function WebWorkerRootRenderer(t,r,o,a){var _this22=this;_classCallCheck(this,WebWorkerRootRenderer),this._serializer=o,this.renderStore=a,this.globalEvents=new NamedEventEmitter,this._componentRenderers=new Map,this._messageBroker=t.createMessageBroker(RENDERER_CHANNEL),r.initChannel(EVENT_CHANNEL);var s=r.from(EVENT_CHANNEL);s.subscribe({next:function(l){return _this22._dispatchEvent(l)}})}return _createClass(WebWorkerRootRenderer,[{key:"_dispatchEvent",value:function(t){var r=this._serializer.deserialize(t.element,2),o=t.animationPlayer;if(o){var a=t.phaseName,s=this._serializer.deserialize(o,2);r.animationPlayerEvents.dispatchEvent(s,a)}else{var _a=t.eventName,_s=t.eventTarget,l=t.event;_s?this.globalEvents.dispatchEvent(eventNameWithTarget(_s,_a),l):r.events.dispatchEvent(_a,l)}}},{key:"renderComponent",value:function(t){var r=this._componentRenderers.get(t.id);if(!r){r=new WebWorkerRenderer(this,t),this._componentRenderers.set(t.id,r);var o=this.renderStore.allocateId();this.renderStore.store(r,o),this.runOnService("renderComponent",[new FnArg(t,_core.RenderComponentType),new FnArg(r,2)])}return r}},{key:"runOnService",value:function(t,r){var o=new UiArguments(t,r);this._messageBroker.runOnService(o,null)}},{key:"allocateNode",value:function(){var t=new WebWorkerRenderNode,r=this.renderStore.allocateId();return this.renderStore.store(t,r),t}},{key:"allocateId",value:function(){return this.renderStore.allocateId()}},{key:"destroyNodes",value:function(t){for(var r=0;r<t.length;r++)this.renderStore.remove(t[r])}}]),WebWorkerRootRenderer}();WebWorkerRootRenderer.decorators=[{type:_core.Injectable}],WebWorkerRootRenderer.ctorParameters=function(){return[{type:ClientMessageBrokerFactory},{type:MessageBus},{type:Serializer},{type:RenderStore}]};var WebWorkerRenderer=function(){function WebWorkerRenderer(t,r){_classCallCheck(this,WebWorkerRenderer),this._rootRenderer=t,this._componentType=r}return _createClass(WebWorkerRenderer,[{key:"_runOnService",value:function(t,r){var o=[new FnArg(this,2)].concat(_toConsumableArray(r));this._rootRenderer.runOnService(t,o)}},{key:"selectRootElement",value:function(t){var o=this._rootRenderer.allocateNode();return this._runOnService("selectRootElement",[new FnArg(t),new FnArg(o,2)]),o}},{key:"createElement",value:function(t,r){var a=this._rootRenderer.allocateNode();return this._runOnService("createElement",[new FnArg(t,2),new FnArg(r),new FnArg(a,2)]),a}},{key:"createViewRoot",value:function(t){var r=this._componentType.encapsulation===_core.ViewEncapsulation.Native?this._rootRenderer.allocateNode():t;return this._runOnService("createViewRoot",[new FnArg(t,2),new FnArg(r,2)]),r}},{key:"createTemplateAnchor",value:function(t){var o=this._rootRenderer.allocateNode();return this._runOnService("createTemplateAnchor",[new FnArg(t,2),new FnArg(o,2)]),o}},{key:"createText",value:function(t,r){var a=this._rootRenderer.allocateNode();return this._runOnService("createText",[new FnArg(t,2),new FnArg(r),new FnArg(a,2)]),a}},{key:"projectNodes",value:function(t,r){this._runOnService("projectNodes",[new FnArg(t,2),new FnArg(r,2)])}},{key:"attachViewAfter",value:function(t,r){this._runOnService("attachViewAfter",[new FnArg(t,2),new FnArg(r,2)])}},{key:"detachView",value:function(t){this._runOnService("detachView",[new FnArg(t,2)])}},{key:"destroyView",value:function(t,r){this._runOnService("destroyView",[new FnArg(t,2),new FnArg(r,2)]),this._rootRenderer.destroyNodes(r)}},{key:"setElementProperty",value:function(t,r,o){this._runOnService("setElementProperty",[new FnArg(t,2),new FnArg(r),new FnArg(o)])}},{key:"setElementAttribute",value:function(t,r,o){this._runOnService("setElementAttribute",[new FnArg(t,2),new FnArg(r),new FnArg(o)])}},{key:"setBindingDebugInfo",value:function(t,r,o){this._runOnService("setBindingDebugInfo",[new FnArg(t,2),new FnArg(r),new FnArg(o)])}},{key:"setElementClass",value:function(t,r,o){this._runOnService("setElementClass",[new FnArg(t,2),new FnArg(r),new FnArg(o)])}},{key:"setElementStyle",value:function(t,r,o){this._runOnService("setElementStyle",[new FnArg(t,2),new FnArg(r),new FnArg(o)])}},{key:"invokeElementMethod",value:function(t,r,o){this._runOnService("invokeElementMethod",[new FnArg(t,2),new FnArg(r),new FnArg(o)])}},{key:"setText",value:function(t,r){this._runOnService("setText",[new FnArg(t,2),new FnArg(r)])}},{key:"listen",value:function(t,r,o){var _this23=this;t.events.listen(r,o);var a=this._rootRenderer.allocateId();return this._runOnService("listen",[new FnArg(t,2),new FnArg(r),new FnArg(a)]),function(){t.events.unlisten(r,o),_this23._runOnService("listenDone",[new FnArg(a)])}}},{key:"listenGlobal",value:function(t,r,o){var _this24=this;this._rootRenderer.globalEvents.listen(eventNameWithTarget(t,r),o);var a=this._rootRenderer.allocateId();return this._runOnService("listenGlobal",[new FnArg(t),new FnArg(r,null),new FnArg(a)]),function(){_this24._rootRenderer.globalEvents.unlisten(eventNameWithTarget(t,r),o),_this24._runOnService("listenDone",[new FnArg(a)])}}},{key:"animate",value:function(t,r,o,a,s,l){var _this25=this,d=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[],m=this._rootRenderer.allocateId(),c=d.map(function(u){return _this25._rootRenderer.renderStore.serialize(u)});this._runOnService("animate",[new FnArg(t,2),new FnArg(r),new FnArg(o),new FnArg(a),new FnArg(s),new FnArg(l),new FnArg(c),new FnArg(m)]);var _=new _AnimationWorkerRendererPlayer(this._rootRenderer,t);return this._rootRenderer.renderStore.store(_,m),_}}]),WebWorkerRenderer}(),WebWorkerRendererFactoryV2=function(){function WebWorkerRendererFactoryV2(t,r,o,a){var _this26=this;_classCallCheck(this,WebWorkerRendererFactoryV2),this._serializer=o,this.renderStore=a,this.globalEvents=new NamedEventEmitter,this._messageBroker=t.createMessageBroker(RENDERER_V2_CHANNEL),r.initChannel(EVENT_V2_CHANNEL);var s=r.from(EVENT_V2_CHANNEL);s.subscribe({next:function(l){return _this26._dispatchEvent(l)}})}return _createClass(WebWorkerRendererFactoryV2,[{key:"createRenderer",value:function(t,r){var o=new WebWorkerRendererV2(this),a=this.renderStore.allocateId();return this.renderStore.store(o,a),this.callUI("createRenderer",[new FnArg(t,2),new FnArg(r,0),new FnArg(o,2)]),o}},{key:"callUI",value:function(t,r){var o=new UiArguments(t,r);this._messageBroker.runOnService(o,null)}},{key:"allocateNode",value:function(){var t=new WebWorkerRenderNode,r=this.renderStore.allocateId();return this.renderStore.store(t,r),t}},{key:"freeNode",value:function(t){this.renderStore.remove(t)}},{key:"allocateId",value:function(){return this.renderStore.allocateId()}},{key:"_dispatchEvent",value:function(t){var r=this._serializer.deserialize(t.element,2),o=t.eventName,a=t.eventTarget,s=t.event;a?this.globalEvents.dispatchEvent(eventNameWithTarget(a,o),s):r.events.dispatchEvent(o,s)}}]),WebWorkerRendererFactoryV2}();WebWorkerRendererFactoryV2.decorators=[{type:_core.Injectable}],WebWorkerRendererFactoryV2.ctorParameters=function(){return[{type:ClientMessageBrokerFactory},{type:MessageBus},{type:Serializer},{type:RenderStore}]};var WebWorkerRendererV2=function(){function WebWorkerRendererV2(t){_classCallCheck(this,WebWorkerRendererV2),this._rendererFactory=t,this.asFnArg=new FnArg(this,2)}return _createClass(WebWorkerRendererV2,[{key:"destroy",value:function(){this.callUIWithRenderer("destroy")}},{key:"destroyNode",value:function(t){this.callUIWithRenderer("destroyNode",[new FnArg(t,2)]),this._rendererFactory.freeNode(t)}},{key:"createElement",value:function(t,r){var o=this._rendererFactory.allocateNode();return this.callUIWithRenderer("createElement",[new FnArg(t),new FnArg(r),new FnArg(o,2)]),o}},{key:"createComment",value:function(t){var r=this._rendererFactory.allocateNode();return this.callUIWithRenderer("createComment",[new FnArg(t),new FnArg(r,2)]),r}},{key:"createText",value:function(t){var r=this._rendererFactory.allocateNode();return this.callUIWithRenderer("createText",[new FnArg(t),new FnArg(r,2)]),r}},{key:"appendChild",value:function(t,r){this.callUIWithRenderer("appendChild",[new FnArg(t,2),new FnArg(r,2)])}},{key:"insertBefore",value:function(t,r,o){t&&this.callUIWithRenderer("insertBefore",[new FnArg(t,2),new FnArg(r,2),new FnArg(o,2)])}},{key:"removeChild",value:function(t,r){this.callUIWithRenderer("removeChild",[new FnArg(t,2),new FnArg(r,2)])}},{key:"selectRootElement",value:function(t){var r=this._rendererFactory.allocateNode();return this.callUIWithRenderer("selectRootElement",[new FnArg(t),new FnArg(r,2)]),r}},{key:"parentNode",value:function(t){var r=this._rendererFactory.allocateNode();return this.callUIWithRenderer("parentNode",[new FnArg(t,2),new FnArg(r,2)]),r}},{key:"nextSibling",value:function(t){var r=this._rendererFactory.allocateNode();return this.callUIWithRenderer("nextSibling",[new FnArg(t,2),new FnArg(r,2)]),r}},{key:"setAttribute",value:function(t,r,o,a){this.callUIWithRenderer("setAttribute",[new FnArg(t,2),new FnArg(r),new FnArg(o),new FnArg(a)])}},{key:"removeAttribute",value:function(t,r,o){this.callUIWithRenderer("removeAttribute",[new FnArg(t,2),new FnArg(r),new FnArg(o)])}},{key:"addClass",value:function(t,r){this.callUIWithRenderer("addClass",[new FnArg(t,2),new FnArg(r)])}},{key:"removeClass",value:function(t,r){this.callUIWithRenderer("removeClass",[new FnArg(t,2),new FnArg(r)])}},{key:"setStyle",value:function(t,r,o,a,s){this.callUIWithRenderer("setStyle",[new FnArg(t,2),new FnArg(r),new FnArg(o),new FnArg(a),new FnArg(s)])}},{key:"removeStyle",value:function(t,r,o){this.callUIWithRenderer("removeStyle",[new FnArg(t,2),new FnArg(r),new FnArg(o)])}},{key:"setProperty",value:function(t,r,o){this.callUIWithRenderer("setProperty",[new FnArg(t,2),new FnArg(r),new FnArg(o)])}},{key:"setValue",value:function(t,r){this.callUIWithRenderer("setValue",[new FnArg(t,2),new FnArg(r)])}},{key:"listen",value:function(t,r,o){var _this27=this,a=this._rendererFactory.allocateId(),_ref3="string"==typeof t?[null,t,t+":"+r]:[t,null,null],_ref4=_slicedToArray(_ref3,3),s=_ref4[0],l=_ref4[1],d=_ref4[2];return d?this._rendererFactory.globalEvents.listen(d,o):s.events.listen(r,o),this.callUIWithRenderer("listen",[new FnArg(s,2),new FnArg(l),new FnArg(r),new FnArg(a)]),function(){d?_this27._rendererFactory.globalEvents.unlisten(d,o):s.events.unlisten(r,o),_this27.callUIWithRenderer("unlisten",[new FnArg(a)])}}},{key:"callUIWithRenderer",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this._rendererFactory.callUI(t,[this.asFnArg].concat(_toConsumableArray(r)))}}]),WebWorkerRendererV2}(),AnimationPlayerEmitter=function(){function AnimationPlayerEmitter(){_classCallCheck(this,AnimationPlayerEmitter)}return _createClass(AnimationPlayerEmitter,[{key:"_getListeners",value:function(t,r){this._listeners||(this._listeners=new Map);var o=this._listeners.get(t);o||this._listeners.set(t,o={});var a=o[r];return a||(a=o[r]=[]),a}},{key:"listen",value:function(t,r,o){this._getListeners(t,r).push(o)}},{key:"unlisten",value:function(t){this._listeners.delete(t)}},{key:"dispatchEvent",value:function(t,r){for(var o=this._getListeners(t,r),a=0;a<o.length;a++)o[a]()}}]),AnimationPlayerEmitter}(),WebWorkerRenderNode=function WebWorkerRenderNode(){_classCallCheck(this,WebWorkerRenderNode),this.events=new NamedEventEmitter,this.animationPlayerEvents=new AnimationPlayerEmitter},_AnimationWorkerRendererPlayer=function(){function _AnimationWorkerRendererPlayer(t,r){_classCallCheck(this,_AnimationWorkerRendererPlayer),this._rootRenderer=t,this._renderElement=r,this.parentPlayer=null,this._destroyed=!1,this._started=!1}return _createClass(_AnimationWorkerRendererPlayer,[{key:"_runOnService",value:function(t,r){if(!this._destroyed){var o=[new FnArg(this,2),new FnArg(this._renderElement,2)].concat(_toConsumableArray(r));this._rootRenderer.runOnService(ANIMATION_WORKER_PLAYER_PREFIX+t,o)}}},{key:"onStart",value:function(t){this._renderElement.animationPlayerEvents.listen(this,"onStart",t),this._runOnService("onStart",[])}},{key:"onDone",value:function(t){this._renderElement.animationPlayerEvents.listen(this,"onDone",t),this._runOnService("onDone",[])}},{key:"onDestroy",value:function(t){this._renderElement.animationPlayerEvents.listen(this,"onDestroy",t),this._runOnService("onDestroy",[])}},{key:"hasStarted",value:function(){return this._started}},{key:"init",value:function(){this._runOnService("init",[])}},{key:"play",value:function(){this._started=!0,this._runOnService("play",[])}},{key:"pause",value:function(){this._runOnService("pause",[])}},{key:"restart",value:function(){this._runOnService("restart",[])}},{key:"finish",value:function(){this._runOnService("finish",[])}},{key:"destroy",value:function(){this._destroyed||(this._renderElement.animationPlayerEvents.unlisten(this),this._runOnService("destroy",[]),this._rootRenderer.renderStore.remove(this),this._destroyed=!0)}},{key:"reset",value:function(){this._runOnService("reset",[])}},{key:"setPosition",value:function(t){this._runOnService("setPosition",[new FnArg(t)])}},{key:"getPosition",value:function(){return 0}}]),_AnimationWorkerRendererPlayer}(),WorkerDomAdapter=function(_DomAdapter){function WorkerDomAdapter(){return _classCallCheck(this,WorkerDomAdapter),_possibleConstructorReturn(this,(WorkerDomAdapter.__proto__||Object.getPrototypeOf(WorkerDomAdapter)).apply(this,arguments))}return _inherits(WorkerDomAdapter,_DomAdapter),_createClass(WorkerDomAdapter,[{key:"logError",value:function(t){console.error?console.error(t):console.log(t)}},{key:"log",value:function(t){console.log(t)}},{key:"logGroup",value:function(t){console.group?(console.group(t),this.logError(t)):console.log(t)}},{key:"logGroupEnd",value:function(){console.groupEnd&&console.groupEnd()}},{key:"hasProperty",value:function(){throw"not implemented"}},{key:"setProperty",value:function(){throw"not implemented"}},{key:"getProperty",value:function(){throw"not implemented"}},{key:"invoke",value:function(){throw"not implemented"}},{key:"parse",value:function(){throw"not implemented"}},{key:"querySelector",value:function(){throw"not implemented"}},{key:"querySelectorAll",value:function(){throw"not implemented"}},{key:"on",value:function(){throw"not implemented"}},{key:"onAndCancel",value:function(){throw"not implemented"}},{key:"dispatchEvent",value:function(){throw"not implemented"}},{key:"createMouseEvent",value:function(){throw"not implemented"}},{key:"createEvent",value:function(){throw"not implemented"}},{key:"preventDefault",value:function(){throw"not implemented"}},{key:"isPrevented",value:function(){throw"not implemented"}},{key:"getInnerHTML",value:function(){throw"not implemented"}},{key:"getTemplateContent",value:function(){throw"not implemented"}},{key:"getOuterHTML",value:function(){throw"not implemented"}},{key:"nodeName",value:function(){throw"not implemented"}},{key:"nodeValue",value:function(){throw"not implemented"}},{key:"type",value:function(){throw"not implemented"}},{key:"content",value:function(){throw"not implemented"}},{key:"firstChild",value:function(){throw"not implemented"}},{key:"nextSibling",value:function(){throw"not implemented"}},{key:"parentElement",value:function(){throw"not implemented"}},{key:"childNodes",value:function(){throw"not implemented"}},{key:"childNodesAsList",value:function(){throw"not implemented"}},{key:"clearNodes",value:function(){throw"not implemented"}},{key:"appendChild",value:function(){throw"not implemented"}},{key:"removeChild",value:function(){throw"not implemented"}},{key:"replaceChild",value:function(){throw"not implemented"}},{key:"remove",value:function(){throw"not implemented"}},{key:"insertBefore",value:function(){throw"not implemented"}},{key:"insertAllBefore",value:function(){throw"not implemented"}},{key:"insertAfter",value:function(){throw"not implemented"}},{key:"setInnerHTML",value:function(){throw"not implemented"}},{key:"getText",value:function(){throw"not implemented"}},{key:"setText",value:function(){throw"not implemented"}},{key:"getValue",value:function(){throw"not implemented"}},{key:"setValue",value:function(){throw"not implemented"}},{key:"getChecked",value:function(){throw"not implemented"}},{key:"setChecked",value:function(){throw"not implemented"}},{key:"createComment",value:function(){throw"not implemented"}},{key:"createTemplate",value:function(){throw"not implemented"}},{key:"createElement",value:function(){throw"not implemented"}},{key:"createElementNS",value:function(){throw"not implemented"}},{key:"createTextNode",value:function(){throw"not implemented"}},{key:"createScriptTag",value:function(){throw"not implemented"}},{key:"createStyleElement",value:function(){throw"not implemented"}},{key:"createShadowRoot",value:function(){throw"not implemented"}},{key:"getShadowRoot",value:function(){throw"not implemented"}},{key:"getHost",value:function(){throw"not implemented"}},{key:"getDistributedNodes",value:function(){throw"not implemented"}},{key:"clone",value:function(){throw"not implemented"}},{key:"getElementsByClassName",value:function(){throw"not implemented"}},{key:"getElementsByTagName",value:function(){throw"not implemented"}},{key:"classList",value:function(){throw"not implemented"}},{key:"addClass",value:function(){throw"not implemented"}},{key:"removeClass",value:function(){throw"not implemented"}},{key:"hasClass",value:function(){throw"not implemented"}},{key:"setStyle",value:function(){throw"not implemented"}},{key:"removeStyle",value:function(){throw"not implemented"}},{key:"getStyle",value:function(){throw"not implemented"}},{key:"hasStyle",value:function(){throw"not implemented"}},{key:"tagName",value:function(){throw"not implemented"}},{key:"attributeMap",value:function(){throw"not implemented"}},{key:"hasAttribute",value:function(){throw"not implemented"}},{key:"hasAttributeNS",value:function(){throw"not implemented"}},{key:"getAttribute",value:function(){throw"not implemented"}},{key:"getAttributeNS",value:function(){throw"not implemented"}},{key:"setAttribute",value:function(){throw"not implemented"}},{key:"setAttributeNS",value:function(){throw"not implemented"}},{key:"removeAttribute",value:function(){throw"not implemented"}},{key:"removeAttributeNS",value:function(){throw"not implemented"}},{key:"templateAwareRoot",value:function(){throw"not implemented"}},{key:"createHtmlDocument",value:function(){throw"not implemented"}},{key:"getBoundingClientRect",value:function(){throw"not implemented"}},{key:"getTitle",value:function(){throw"not implemented"}},{key:"setTitle",value:function(){throw"not implemented"}},{key:"elementMatches",value:function(){throw"not implemented"}},{key:"isTemplateElement",value:function(){throw"not implemented"}},{key:"isTextNode",value:function(){throw"not implemented"}},{key:"isCommentNode",value:function(){throw"not implemented"}},{key:"isElementNode",value:function(){throw"not implemented"}},{key:"hasShadowRoot",value:function(){throw"not implemented"}},{key:"isShadowRoot",value:function(){throw"not implemented"}},{key:"importIntoDoc",value:function(){throw"not implemented"}},{key:"adoptNode",value:function(){throw"not implemented"}},{key:"getHref",value:function(){throw"not implemented"}},{key:"getEventKey",value:function(){throw"not implemented"}},{key:"resolveAndSetHref",value:function(){throw"not implemented"}},{key:"supportsDOMEvents",value:function(){throw"not implemented"}},{key:"supportsNativeShadowDOM",value:function(){throw"not implemented"}},{key:"getGlobalEventTarget",value:function(){throw"not implemented"}},{key:"getHistory",value:function(){throw"not implemented"}},{key:"getLocation",value:function(){throw"not implemented"}},{key:"getBaseHref",value:function(){throw"not implemented"}},{key:"resetBaseElement",value:function(){throw"not implemented"}},{key:"getUserAgent",value:function(){throw"not implemented"}},{key:"setData",value:function(){throw"not implemented"}},{key:"getComputedStyle",value:function(){throw"not implemented"}},{key:"getData",value:function(){throw"not implemented"}},{key:"setGlobalVar",value:function(){throw"not implemented"}},{key:"performanceNow",value:function(){throw"not implemented"}},{key:"getAnimationPrefix",value:function(){throw"not implemented"}},{key:"getTransitionEnd",value:function(){throw"not implemented"}},{key:"supportsAnimation",value:function(){throw"not implemented"}},{key:"supportsWebAnimation",value:function(){throw"not implemented"}},{key:"supportsCookies",value:function(){return!1}},{key:"getCookie",value:function(){throw"not implemented"}},{key:"setCookie",value:function(){throw"not implemented"}},{key:"attrToPropMap",get:function(){throw"not implemented"},set:function(t){throw"not implemented"}}],[{key:"makeCurrent",value:function(){(0,_platformBrowser.ɵsetRootDomAdapter)(new WorkerDomAdapter)}}]),WorkerDomAdapter}(_platformBrowser.ɵDomAdapter),platformWorkerApp=(0,_core.createPlatformFactory)(_core.platformCore,"workerApp"),_postMessage={postMessage:function(_postMessage2){function postMessage(_x12,_x13){return _postMessage2.apply(this,arguments)}return postMessage.toString=function(){return _postMessage2.toString()},postMessage}(function(t,r){postMessage(t,r)})},WorkerAppModule=function WorkerAppModule(){_classCallCheck(this,WorkerAppModule)};WorkerAppModule.decorators=[{type:_core.NgModule,args:[{providers:[_platformBrowser.ɵBROWSER_SANITIZATION_PROVIDERS,Serializer,{provide:_platformBrowser.DOCUMENT,useValue:null},{provide:ClientMessageBrokerFactory,useClass:ClientMessageBrokerFactory_},{provide:ServiceMessageBrokerFactory,useClass:ServiceMessageBrokerFactory_},WebWorkerRootRenderer,{provide:_core.RootRenderer,useExisting:WebWorkerRootRenderer},WebWorkerRendererFactoryV2,{provide:_core.RendererFactoryV2,useExisting:WebWorkerRendererFactoryV2},{provide:ON_WEB_WORKER,useValue:!0},RenderStore,{provide:_core.ErrorHandler,useFactory:errorHandler,deps:[]},{provide:MessageBus,useFactory:createMessageBus,deps:[_core.NgZone]},{provide:_core.APP_INITIALIZER,useValue:setupWebWorker,multi:!0}],exports:[_common.CommonModule,_core.ApplicationModule]}]}],WorkerAppModule.ctorParameters=function(){return[]},exports.VERSION=VERSION,exports.ClientMessageBroker=ClientMessageBroker,exports.ClientMessageBrokerFactory=ClientMessageBrokerFactory,exports.FnArg=FnArg,exports.UiArguments=UiArguments,exports.MessageBus=MessageBus,exports.PRIMITIVE=PRIMITIVE,exports.ServiceMessageBroker=ServiceMessageBroker,exports.ServiceMessageBrokerFactory=ServiceMessageBrokerFactory,exports.WORKER_UI_LOCATION_PROVIDERS=WORKER_UI_LOCATION_PROVIDERS,exports.WORKER_APP_LOCATION_PROVIDERS=WORKER_APP_LOCATION_PROVIDERS,exports.WorkerAppModule=WorkerAppModule,exports.platformWorkerApp=platformWorkerApp,exports.platformWorkerUi=platformWorkerUi,exports.bootstrapWorkerUi=bootstrapWorkerUi,exports.ɵk=ON_WEB_WORKER,exports.ɵa=ClientMessageBrokerFactory_,exports.ɵh=RenderStore,exports.ɵb=Serializer,exports.ɵc=ServiceMessageBrokerFactory_,exports.ɵj=WebWorkerRendererFactoryV2,exports.ɵi=WebWorkerRootRenderer,exports.ɵe=createMessageBus,exports.ɵd=errorHandler,exports.ɵf=setupWebWorker,exports.ɵg=_WORKER_UI_PLATFORM_PROVIDERS});