{"version":3,"file":"platform_location.js","sourceRoot":"","sources":["../../../../../../modules/@angular/platform-webworker/src/web_workers/worker/platform_location.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nimport {LocationChangeListener, PlatformLocation} from '@angular/common';\nimport {Injectable} from '@angular/core';\n\nimport {EventEmitter} from '../../facade/async';\nimport {ClientMessageBroker, ClientMessageBrokerFactory, FnArg, UiArguments} from '../shared/client_message_broker';\nimport {MessageBus} from '../shared/message_bus';\nimport {ROUTER_CHANNEL} from '../shared/messaging_api';\nimport {LocationType} from '../shared/serialized_types';\nimport {PRIMITIVE, Serializer} from '../shared/serializer';\n\nimport {deserializeGenericEvent} from './event_deserializer';\nexport class WebWorkerPlatformLocation extends PlatformLocation {\nprivate _broker: ClientMessageBroker;\nprivate _popStateListeners: Array<Function> = [];\nprivate _hashChangeListeners: Array<Function> = [];\nprivate _location: LocationType = null;\nprivate _channelSource: EventEmitter<Object>;\n/**\n * @param {?} brokerFactory\n * @param {?} bus\n * @param {?} _serializer\n */\nconstructor(\n      brokerFactory: ClientMessageBrokerFactory, bus: MessageBus,\nprivate _serializer: Serializer) {\n    super();\n    this._broker = brokerFactory.createMessageBroker(ROUTER_CHANNEL);\n\n    this._channelSource = bus.from(ROUTER_CHANNEL);\n    this._channelSource.subscribe({\n      next: (msg: {[key: string]: any}) => {\n        let listeners: Array<Function> = null;\n        if (msg.hasOwnProperty('event')) {\n          const type: string = msg['event']['type'];\n          if (type === 'popstate') {\n            listeners = this._popStateListeners;\n          } else if (type === 'hashchange') {\n            listeners = this._hashChangeListeners;\n          }\n\n          if (listeners !== null) {\n            const e = deserializeGenericEvent(msg['event']);\n            // There was a popState or hashChange event, so the location object thas been updated\n            this._location = this._serializer.deserialize(msg['location'], LocationType);\n            listeners.forEach((fn: Function) => fn(e));\n          }\n        }\n      }\n    });\n  }\n/**\n * \\@internal *\n * @return {?}\n */\ninit(): Promise<boolean> {\n    const /** @type {?} */ args: UiArguments = new UiArguments('getLocation');\n\n    const /** @type {?} */ locationPromise: Promise<LocationType> = this._broker.runOnService(args, LocationType);\n    return locationPromise.then(\n        (val: LocationType):\n            boolean => {\n              this._location = val;\n              return true;\n            },\n        (err): boolean => { throw new Error(err); });\n  }\n/**\n * @return {?}\n */\ngetBaseHrefFromDOM(): string {\n    throw new Error(\n        'Attempt to get base href from DOM from WebWorker. You must either provide a value for the APP_BASE_HREF token through DI or use the hash location strategy.');\n  }\n/**\n * @param {?} fn\n * @return {?}\n */\nonPopState(fn: LocationChangeListener): void { this._popStateListeners.push(fn); }\n/**\n * @param {?} fn\n * @return {?}\n */\nonHashChange(fn: LocationChangeListener): void { this._hashChangeListeners.push(fn); }\n/**\n * @return {?}\n */\nget pathname(): string {\n    if (this._location === null) {\n      return null;\n    }\n\n    return this._location.pathname;\n  }\n/**\n * @return {?}\n */\nget search(): string {\n    if (this._location === null) {\n      return null;\n    }\n\n    return this._location.search;\n  }\n/**\n * @return {?}\n */\nget hash(): string {\n    if (this._location === null) {\n      return null;\n    }\n\n    return this._location.hash;\n  }\n/**\n * @param {?} newPath\n * @return {?}\n */\nset pathname(newPath: string) {\n    if (this._location === null) {\n      throw new Error('Attempt to set pathname before value is obtained from UI');\n    }\n\n    this._location.pathname = newPath;\n\n    const /** @type {?} */ fnArgs = [new FnArg(newPath, PRIMITIVE)];\n    const /** @type {?} */ args = new UiArguments('setPathname', fnArgs);\n    this._broker.runOnService(args, null);\n  }\n/**\n * @param {?} state\n * @param {?} title\n * @param {?} url\n * @return {?}\n */\npushState(state: any, title: string, url: string): void {\n    const /** @type {?} */ fnArgs =\n        [new FnArg(state, PRIMITIVE), new FnArg(title, PRIMITIVE), new FnArg(url, PRIMITIVE)];\n    const /** @type {?} */ args = new UiArguments('pushState', fnArgs);\n    this._broker.runOnService(args, null);\n  }\n/**\n * @param {?} state\n * @param {?} title\n * @param {?} url\n * @return {?}\n */\nreplaceState(state: any, title: string, url: string): void {\n    const /** @type {?} */ fnArgs =\n        [new FnArg(state, PRIMITIVE), new FnArg(title, PRIMITIVE), new FnArg(url, PRIMITIVE)];\n    const /** @type {?} */ args = new UiArguments('replaceState', fnArgs);\n    this._broker.runOnService(args, null);\n  }\n/**\n * @return {?}\n */\nforward(): void {\n    const /** @type {?} */ args = new UiArguments('forward');\n    this._broker.runOnService(args, null);\n  }\n/**\n * @return {?}\n */\nback(): void {\n    const /** @type {?} */ args = new UiArguments('back');\n    this._broker.runOnService(args, null);\n  }\nstatic decorators: DecoratorInvocation[] = [\n{ type: Injectable },\n];\n/** @nocollapse */\nstatic ctorParameters: () => ({type: any, decorators?: DecoratorInvocation[]}|null)[] = () => [\n{type: ClientMessageBrokerFactory, },\n{type: MessageBus, },\n{type: Serializer, },\n];\n}\n\nfunction WebWorkerPlatformLocation_tsickle_Closure_declarations() {\n/** @type {?} */\nWebWorkerPlatformLocation.decorators;\n/**\n * @nocollapse\n * @type {?}\n */\nWebWorkerPlatformLocation.ctorParameters;\n/** @type {?} */\nWebWorkerPlatformLocation.prototype._broker;\n/** @type {?} */\nWebWorkerPlatformLocation.prototype._popStateListeners;\n/** @type {?} */\nWebWorkerPlatformLocation.prototype._hashChangeListeners;\n/** @type {?} */\nWebWorkerPlatformLocation.prototype._location;\n/** @type {?} */\nWebWorkerPlatformLocation.prototype._channelSource;\n/** @type {?} */\nWebWorkerPlatformLocation.prototype._serializer;\n}\n\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}