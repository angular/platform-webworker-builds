{"version":3,"sources":["../../../../../../modules/@angular/platform-webworker/src/web_workers/worker/platform_location.ts"],"names":[],"mappings":"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","file":"platform_location.js","sourceRoot":"","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nimport {LocationChangeListener, PlatformLocation} from '@angular/common/index';\nimport {Injectable} from '@angular/core/index';\n\nimport {EventEmitter} from '../../facade/async';\nimport {ClientMessageBroker, ClientMessageBrokerFactory, FnArg, UiArguments} from '../shared/client_message_broker';\nimport {MessageBus} from '../shared/message_bus';\nimport {ROUTER_CHANNEL} from '../shared/messaging_api';\nimport {LocationType, Serializer, SerializerTypes} from '../shared/serializer';\nexport class WebWorkerPlatformLocation extends PlatformLocation {\nprivate _broker: ClientMessageBroker;\nprivate _popStateListeners: Array<Function> = [];\nprivate _hashChangeListeners: Array<Function> = [];\nprivate _location: LocationType = null;\nprivate _channelSource: EventEmitter<Object>;\npublic initialized: Promise<any>;\nprivate initializedResolve: () => void;\n/**\n * @param {?} brokerFactory\n * @param {?} bus\n * @param {?} _serializer\n */\nconstructor(\n      brokerFactory: ClientMessageBrokerFactory, bus: MessageBus,\nprivate _serializer: Serializer) {\n    super();\n    this._broker = brokerFactory.createMessageBroker(ROUTER_CHANNEL);\n    this._channelSource = bus.from(ROUTER_CHANNEL);\n\n    this._channelSource.subscribe({\n      next: (msg: {[key: string]: any}) => {\n        let listeners: Array<Function> = null;\n        if (msg.hasOwnProperty('event')) {\n          const type: string = msg['event']['type'];\n          if (type === 'popstate') {\n            listeners = this._popStateListeners;\n          } else if (type === 'hashchange') {\n            listeners = this._hashChangeListeners;\n          }\n\n          if (listeners) {\n            // There was a popState or hashChange event, so the location object thas been updated\n            this._location = this._serializer.deserialize(msg['location'], LocationType);\n            listeners.forEach((fn: Function) => fn(msg['event']));\n          }\n        }\n      }\n    });\n    this.initialized = new Promise(res => this.initializedResolve = res);\n  }\n/**\n * \\@internal *\n * @return {?}\n */\ninit(): Promise<boolean> {\n    const /** @type {?} */ args: UiArguments = new UiArguments('getLocation');\n\n    return this._broker.runOnService(args, LocationType)\n        .then(\n            (val: LocationType) => {\n              this._location = val;\n              this.initializedResolve();\n              return true;\n            },\n            err => { throw new Error(err); });\n  }\n/**\n * @return {?}\n */\ngetBaseHrefFromDOM(): string {\n    throw new Error(\n        'Attempt to get base href from DOM from WebWorker. You must either provide a value for the APP_BASE_HREF token through DI or use the hash location strategy.');\n  }\n/**\n * @param {?} fn\n * @return {?}\n */\nonPopState(fn: LocationChangeListener): void { this._popStateListeners.push(fn); }\n/**\n * @param {?} fn\n * @return {?}\n */\nonHashChange(fn: LocationChangeListener): void { this._hashChangeListeners.push(fn); }\n/**\n * @return {?}\n */\nget pathname(): string { return this._location ? this._location.pathname : null; }\n/**\n * @return {?}\n */\nget search(): string { return this._location ? this._location.search : null; }\n/**\n * @return {?}\n */\nget hash(): string { return this._location ? this._location.hash : null; }\n/**\n * @param {?} newPath\n * @return {?}\n */\nset pathname(newPath: string) {\n    if (this._location === null) {\n      throw new Error('Attempt to set pathname before value is obtained from UI');\n    }\n\n    this._location.pathname = newPath;\n\n    const /** @type {?} */ fnArgs = [new FnArg(newPath, SerializerTypes.PRIMITIVE)];\n    const /** @type {?} */ args = new UiArguments('setPathname', fnArgs);\n    this._broker.runOnService(args, null);\n  }\n/**\n * @param {?} state\n * @param {?} title\n * @param {?} url\n * @return {?}\n */\npushState(state: any, title: string, url: string): void {\n    const /** @type {?} */ fnArgs = [\n      new FnArg(state, SerializerTypes.PRIMITIVE),\n      new FnArg(title, SerializerTypes.PRIMITIVE),\n      new FnArg(url, SerializerTypes.PRIMITIVE),\n    ];\n    const /** @type {?} */ args = new UiArguments('pushState', fnArgs);\n    this._broker.runOnService(args, null);\n  }\n/**\n * @param {?} state\n * @param {?} title\n * @param {?} url\n * @return {?}\n */\nreplaceState(state: any, title: string, url: string): void {\n    const /** @type {?} */ fnArgs = [\n      new FnArg(state, SerializerTypes.PRIMITIVE),\n      new FnArg(title, SerializerTypes.PRIMITIVE),\n      new FnArg(url, SerializerTypes.PRIMITIVE),\n    ];\n    const /** @type {?} */ args = new UiArguments('replaceState', fnArgs);\n    this._broker.runOnService(args, null);\n  }\n/**\n * @return {?}\n */\nforward(): void {\n    const /** @type {?} */ args = new UiArguments('forward');\n    this._broker.runOnService(args, null);\n  }\n/**\n * @return {?}\n */\nback(): void {\n    const /** @type {?} */ args = new UiArguments('back');\n    this._broker.runOnService(args, null);\n  }\nstatic decorators: DecoratorInvocation[] = [\n{ type: Injectable },\n];\n/** @nocollapse */\nstatic ctorParameters: () => ({type: any, decorators?: DecoratorInvocation[]}|null)[] = () => [\n{type: ClientMessageBrokerFactory, },\n{type: MessageBus, },\n{type: Serializer, },\n];\n}\n\nfunction WebWorkerPlatformLocation_tsickle_Closure_declarations() {\n/** @type {?} */\nWebWorkerPlatformLocation.decorators;\n/**\n * @nocollapse\n * @type {?}\n */\nWebWorkerPlatformLocation.ctorParameters;\n/** @type {?} */\nWebWorkerPlatformLocation.prototype._broker;\n/** @type {?} */\nWebWorkerPlatformLocation.prototype._popStateListeners;\n/** @type {?} */\nWebWorkerPlatformLocation.prototype._hashChangeListeners;\n/** @type {?} */\nWebWorkerPlatformLocation.prototype._location;\n/** @type {?} */\nWebWorkerPlatformLocation.prototype._channelSource;\n/** @type {?} */\nWebWorkerPlatformLocation.prototype.initialized;\n/** @type {?} */\nWebWorkerPlatformLocation.prototype.initializedResolve;\n/** @type {?} */\nWebWorkerPlatformLocation.prototype._serializer;\n}\n\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}